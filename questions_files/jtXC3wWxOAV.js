/*!CK:2667087043!*//*1448250951,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["XugSX"]); }

__d('AvailableListConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:'webStatus',FB_APP_STATUS:'fbAppStatus',MESSENGER_STATUS:'messengerStatus',OTHER_STATUS:'otherStatus',STATUS_ACTIVE:'active',STATUS_IDLE:'idle',STATUS_OFFLINE:'offline'};b.AvailableListConstants=f.exports=h;},null);
__d('LastMobileActiveTimes',['ServerTime','fbt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={};function k(o){if(!o||o<0)return '';var p=h.get()/1000-o,q=Math.floor(p/60),r=Math.floor(q/60),s=Math.floor(r/24);if(q<=1){return i._("{count}m",[i.param('count',1)]);}else if(q<60){return i._("{count}m",[i.param('count',q)]);}else if(r<24){return i._("{count}h",[i.param('count',r)]);}else if(s<3){return i._("{count}d",[i.param('count',s)]);}else return '';}function l(o,p){if(!(o in j)||j[o]<p)j[o]=p;}function m(o){if(o in j){return j[o];}else return 0;}var n={update:function(o){for(var p in o)l(p,o[p]);},getShortDisplay:function(o){return k(m(o));},get:function(o){return m(o);},getDebugData:function(){return j;}};f.exports=n;},null);
__d('PresenceUtil',['CurrentUser','randomInt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=i(0,4294967295)+1;function k(){return j;}function l(){return h.isLoggedInNow();}f.exports={getSessionID:k,hasUserCookie:l};},null);
__d('PresencePrivacy',['Arbiter','AsyncRequest','ChannelConstants','CurrentUser','PresencePrivacyInitialData','JSLogger','PresenceUtil'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u=babelHelpers._extends({},l.privacyData),v=l.visibility,w=babelHelpers._extends({},l.privacyData),x=v,y=l.onlinePolicy,z=y,aa=[],ba=false;function ca(){return m.create('blackbird');}var da=Object.assign(new h(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==k.getID()){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');h.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){var sa=aa.shift();ia(sa.request,sa.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;if(!Array.isArray(ta)){da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);Object.assign(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){var ra=aa.shift();ia(ra.request,ra.data);}}function na(qa,ra){if(n!=null){var sa=qa.getData();sa.window_id=n.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new i(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=k.getID()){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===n.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}Object.assign(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},isUserOffline:function(){return this.getVisibility()===da.OFFLINE;},allows:function(qa){if(this.isUserOffline())return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});da.inform('privacy-changed');da.inform('privacy-user-presence-changed',h.BEHAVIOR_STATE);ca().log('initialized',{visibility:v,policy:y});h.subscribe(m.DUMP_EVENT,function(qa,ra){ra.presence_privacy={initial:l.privacyData,current:u};});h.subscribe(j.getArbiterType('privacy_changed'),pa.bind(this));h.subscribe(j.ON_CONFIG,(function(qa,ra){var sa=ra.getConfig('visibility',null);if(sa!==null&&typeof sa!=='undefined'){var ta=sa?da.ONLINE:da.OFFLINE;ga(ta);ca().log('config_visibility',{vis:ta});}}).bind(this));f.exports=da;},null);
__d('ChatVisibility',['Arbiter','JSLogger','PresencePrivacy'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={isOnline:function(){return j.getVisibility()===j.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return j.getOnlinePolicy()===j.ONLINE_TO_BLACKLIST&&j.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return j.getOnlinePolicy()===j.ONLINE_TO_WHITELIST&&j.getWhitelist().length>0;},goOnline:function(l){if(j.getVisibility()===j.OFFLINE){i.create('blackbird').log('chat_go_online');j.setVisibility(j.ONLINE);h.inform('chat-visibility/go-online');}l&&l();},goOffline:function(l){if(j.getVisibility()===j.ONLINE){i.create('blackbird').log('chat_go_offline');j.setVisibility(j.OFFLINE);h.inform('chat-visibility/go-offline');}l&&l();},toggleVisibility:function(){if(k.isOnline()){k.goOffline();}else k.goOnline();}};f.exports=k;},null);
__d('PresenceStatus',['ArbiterMixin','AvailableListConstants','BanzaiODS','ChatVisibility','CurrentUser','LastMobileActiveTimes','LogHistory','Set','PresencePrivacy','ServerTime','createObjectFrom','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();j.setEntitySample('presence',.0001);var t=n.getInstance('presence_status'),u={},v={},w={},x={},y=new o(),z={},aa={},ba=Object.assign({},h),ca=s(function(){return ba.inform('change');},0);Object.assign(ba,{resetPresenceData:function(){v={};w={};aa={};z={};},reset:function(){ba.resetPresenceData();x={};},get:function(da){if(da==l.getID())return k.isOnline()?i.ACTIVE:i.OFFLINE;var ea=i.OFFLINE;if(da in v)ea=v[da];if(ea===i.OFFLINE||ea===i.IDLE)if(x[da])ea=i.MOBILE;if(!p.allows(da))ea=i.OFFLINE;return ea;},getCapabilities:function(da){var ea=ba.get(da);if(ea==i.OFFLINE)return 0;var fa=w[da];return fa?fa:0;},isMobileUser:function(da){return x[da];},getGroup:function(da){return da.some(function(ea){if(ea==l.getID())return false;return ba.get(ea)===i.ACTIVE;})?i.ACTIVE:i.OFFLINE;},set:function(da,ea,fa,ga,ha,ia){if(da==l.getID())return false;if(y.has(parseInt(da,10)))return false;var ja=ba.get(da),ka=false;if(ea!==undefined&&ea!==null){ka=ja!=ea;switch(ea){case i.OFFLINE:case i.IDLE:case i.ACTIVE:case i.MOBILE:break;default:return false;}if(ka&&ja==i.ACTIVE||ea==i.ACTIVE){var la={};la[da]=q.get()/1000;m.update(la);}v[da]=ea;}var ma=false;if(ha)ma=ba.getCapabilities(da)!=ha;if(fa){z[da]=q.get();aa[da]=ga;}if(ha)w[da]=ha;var na=ka||ma;if(na&&!ia)ca();return na;},setMobileFriends:function(da){x=r(da);},setPerpetuallyMobileBuddies:function(da){y=new o(da);},getOnlineIDs:function(){var da,ea=[];for(da in v)if(ba.get(da)===i.ACTIVE)ea.push(da);return ea;},getAvailableIDs:function(){var da=ba.getOnlineIDs(),ea;for(ea in x){if(v[ea])continue;da.push(ea);}return da;},getOnlineCount:function(){return ba.getOnlineIDs().length;},getPresenceStats:function(){var da=0,ea=0,fa=0,ga=0,ha=0;for(var ia in v){da+=1;switch(ba.get(ia)){case i.OFFLINE:ea+=1;break;case i.IDLE:fa+=1;break;case i.ACTIVE:ga+=1;break;case i.MOBILE:ha+=1;break;default:break;}}return {total:da,offline:ea,idle:fa,active:ga,mobile:ha};},getDebugInfo:function(da){return {id:da,presence:v[da],overlaySource:aa[da],overlayTime:z[da],mobile:x[da]};},getAllDebugInfo:function(){return {presence:v,overlaySource:aa,overlayTime:z,mobile:x};},setMulti:function(da,ea){var fa=false;for(var ga in da)ba.set(ga,da[ga].a,false,ea,da[ga].c,true)&&(fa=true);if(fa)ca();}});f.exports=ba;},null);
__d('ChatproxyPresence',['Arbiter','AvailableListConstants','AvailableListInitialData','ChannelConstants','CurrentUser','LastMobileActiveTimes','PresenceStatus','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(q){'use strict';this.$ChatproxyPresence1=q;this.$ChatproxyPresence2=j.chatNotif;var r=j.availableList,s=j.lastActiveTimes,t=j.mobileFriends,u=j.perpetuallyMobileBuddies;if(r&&Object.keys(r).length>0)n.setMulti(r,'available_list_initial_data');if(s&&!Array.isArray(s))m.update(s);if(t)n.setMobileFriends(t);if(u)n.setPerpetuallyMobileBuddies(u);}p.prototype.subscribe=function(){'use strict';h.subscribe(k.getArbiterType('chatproxy-presence'),this.updatePresenceInfo.bind(this));h.subscribe(k.ON_INVALID_HISTORY,this.onFullReloadReceived.bind(this));};p.prototype.onFullReloadReceived=function(){'use strict';n.resetPresenceData();};p.prototype.getAvailableListConstant=function(q){'use strict';switch(q){case 0:case 3:return i.OFFLINE;case 1:return i.IDLE;case 2:return i.ACTIVE;}return undefined;};p.prototype.updatePresenceInfo=function(q,r){'use strict';var s={};r=r.obj;var t=r.buddyList;for(var u in t){if(u===l.getID()||u==='type')continue;var v=this.getAvailableListConstant(t[u].p),w=0;if(t[u].vc)w=t[u].vc;if(t[u].lat)s[u]=t[u].lat;if(v!==undefined||w!==undefined)if(j.gk_replace_available_list_chatproxy)n.set(u,v,false,'chatproxy',w);}var x=false;if(r.chatNotif!==undefined)x=this.$ChatproxyPresence2!==r.chatNotif;if(x)this.$ChatproxyPresence2=r.chatNotif;if(j.gk_replace_available_list_chatproxy){m.update(s);if(!!r.mobileFriends)n.setMobileFriends(r.mobileFriends);if(x)this.$ChatproxyPresence1(i.ON_CHAT_NOTIFICATION_CHANGED,this.$ChatproxyPresence2);o((function(){this.$ChatproxyPresence1(i.ON_AVAILABILITY_CHANGED);}).bind(this),0)();}};p.prototype.getIsUserIdle=function(){'use strict';return this.$ChatproxyPresence3;};p.prototype.getWebChatNotification=function(){'use strict';return this.$ChatproxyPresence2;};f.exports=p;},null);
__d('ChatproxyLastMobileActiveTimes',['ServerTime','fbt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={};function k(o){if(!o||o<0)return '';var p=h.get()/1000-o,q=Math.floor(p/60),r=Math.floor(q/60),s=Math.floor(r/24);if(q<=1){return i._("{count}m",[i.param('count',1)]);}else if(q<60){return i._("{count}m",[i.param('count',q)]);}else if(r<24){return i._("{count}h",[i.param('count',r)]);}else if(s<3){return i._("{count}d",[i.param('count',s)]);}else return '';}function l(o,p){if(!(o in j)||j[o]<p)j[o]=p;}function m(o){if(o in j){return j[o];}else return 0;}var n={update:function(o){for(var p in o)l(p,o[p]);},getShortDisplay:function(o){return k(m(o));},get:function(o){return m(o);},getDebugData:function(){return j;}};f.exports=n;},null);
__d('ChatproxyPresenceStatus',['ArbiterMixin','AvailableListConstants','BanzaiODS','ChatVisibility','CurrentUser','ChatproxyLastMobileActiveTimes','LogHistory','PresencePrivacy','ServerTime','createObjectFrom','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();j.setEntitySample('presence',.0001);var s=n.getInstance('presence_status'),t={},u={},v={},w={},x={},y={},z=Object.assign({},h),aa=r(function(){return z.inform('change');},0);Object.assign(z,{resetPresenceData:function(){u={};v={};y={};x={};},reset:function(){z.resetPresenceData();w={};},get:function(ba){if(ba==l.getID())return k.isOnline()?i.ACTIVE:i.OFFLINE;var ca=i.OFFLINE;if(ba in u)ca=u[ba];if(ca===i.OFFLINE||ca===i.IDLE)if(w[ba])ca=i.MOBILE;if(!o.allows(ba))ca=i.OFFLINE;return ca;},getCapabilities:function(ba){var ca=z.get(ba);if(ca==i.OFFLINE)return 0;var da=v[ba];return da?da:0;},isMobileUser:function(ba){return w[ba];},getGroup:function(ba){return ba.some(function(ca){if(ca==l.getID())return false;return z.get(ca)===i.ACTIVE;})?i.ACTIVE:i.OFFLINE;},set:function(ba,ca,da,ea,fa){if(ba==l.getID())return false;switch(ca){case i.OFFLINE:case i.IDLE:case i.ACTIVE:case i.MOBILE:break;default:return false;}var ga=z.get(ba),ha=ga!=ca;if(ha&&ga==i.ACTIVE||ca==i.ACTIVE){var ia={};ia[ba]=p.get()/1000;m.update(ia);}var ja=false;if(!ha&&fa)ja=z.getCapabilities(ba)!=fa;if(da){x[ba]=p.get();y[ba]=ea;}u[ba]=ca;if(fa)v[ba]=fa;var ka=ha||ja;if(ka)aa();return ka;},setMobileFriends:function(ba){w=q(ba);},getOnlineIDs:function(){var ba,ca=[];for(ba in u)if(z.get(ba)===i.ACTIVE)ca.push(ba);return ca;},getAvailableIDs:function(){var ba=z.getOnlineIDs(),ca;for(ca in w){if(u[ca])continue;ba.push(ca);}return ba;},getOnlineCount:function(){return z.getOnlineIDs().length;},getPresenceStats:function(){var ba=0,ca=0,da=0,ea=0,fa=0;for(var ga in u){ba+=1;switch(z.get(ga)){case i.OFFLINE:ca+=1;break;case i.IDLE:da+=1;break;case i.ACTIVE:ea+=1;break;case i.MOBILE:fa+=1;break;default:break;}}return {total:ba,offline:ca,idle:da,active:ea,mobile:fa};},getDebugInfo:function(ba){return {id:ba,presence:u[ba],overlaySource:y[ba],overlayTime:x[ba],mobile:w[ba]};},getAllDebugInfo:function(){return {presence:u,overlaySource:y,overlayTime:x,mobile:w};}});f.exports=z;},null);
__d('ChatConfig',['ChatConfigInitialData'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={},j={get:function(k,l){return k in i?i[k]:l;},set:function(k){if(arguments.length>1){var l={};l[k]=arguments[1];k=l;}Object.assign(i,k);},getDebugInfo:function(){return i;}};j.set(h);f.exports=j;},null);
__d('ChatContexts',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};function i(l){var m=l?l.subtext:'';return m;}function j(l,m){h[l]=m;}var k={get:function(l){if(l in h){return h[l];}else return null;},update:function(l){for(var m in l)j(m,l[m]);},getShortDisplay:function(l){return i(k.get(l));}};f.exports=k;},null);
__d('Poller',['ArbiterMixin','AsyncRequest','CurrentUser','emptyFunction','mixin','setTimeoutAcrossTransitions','setTimeout'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;o=babelHelpers.inherits(q,l(h));p=o&&o.prototype;function q(t){'use strict';p.constructor.call(this);this._config=babelHelpers._extends({clearOnQuicklingEvents:true,setupRequest:k,interval:null,maxRequests:Infinity,dontStart:false},t);this._handle=null;if(!this._config.dontStart)this.start();}q.prototype.start=function(){'use strict';if(this._polling)return this;this._requests=0;this.request();return this;};q.prototype.stop=function(){'use strict';this._cancelRequest();return this;};q.prototype.mute=function(){'use strict';this._muted=true;return this;};q.prototype.resume=function(){'use strict';if(this._muted){this._muted=false;if(this._handle===null&&this._polling)return this.request();}return this;};q.prototype.skip=function(){'use strict';this._skip=true;return this;};q.prototype.reset=function(){'use strict';return this.stop().start();};q.prototype.request=function(){'use strict';this._cancelRequest();this._polling=true;if(!s())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var t=new i();t.setIsBackgroundRequest(true);var u=false;t.setInitialHandler(function(){return !u;});this._cancelRequest=(function(){u=true;this._cleanup();}).bind(this);t.setFinallyHandler(r.bind(this));t.setInitialHandler=k;t.setFinallyHandler=k;this._config.setupRequest(t,this);if(this._skip){this._skip=false;m(r.bind(this),0);}else t.send();return this;};q.prototype.isPolling=function(){'use strict';return this._polling;};q.prototype.isMuted=function(){'use strict';return this._muted;};q.prototype.setInterval=function(t){'use strict';if(t){this._config.interval=t;this.start();}};q.prototype.getInterval=function(){'use strict';return this._config.interval;};q.prototype._cleanup=function(){'use strict';if(this._handle!==null)clearTimeout(this._handle);this._handle=null;this._cancelRequest=k;this._polling=false;};q.prototype._done=function(){'use strict';this._cleanup();this.inform('done',{sender:this});return this;};q.MIN_INTERVAL=2000;Object.assign(q.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:k});function r(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var t=this._config.interval;t=typeof t==='function'?t(this._requests):t;t=t>q.MIN_INTERVAL?t:q.MIN_INTERVAL;if(this._config.clearOnQuicklingEvents){this._handle=n(this.request.bind(this),t);}else this._handle=m(this.request.bind(this),t);}else this._done();}function s(){return j.isLoggedInNow();}f.exports=q;},null);
__d('PresencePoller',['AvailableListConstants','AvailableListInitialData','BanzaiODS','ChatContexts','ChatVisibility','CurrentUser','JSLogger','LastMobileActiveTimes','Poller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','UserActivity','debounceAcrossTransitions','errorCode','ifRequired'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y=5,z='/ajax/chat/buddy_list.php',aa=1800000,ba=i.pollInterval,ca=i.lazyPollInterval,da=i.lazyThreshold,ea=n.create('available_list'),fa='presence_poller';j.setEntitySample(fa,.01);function ga(ha){'use strict';this.$PresencePoller1=ha;this.$PresencePoller2=false;this.$PresencePoller3=i.chatNotif;this.$PresencePoller4=false;this.$PresencePoller5=[];this.$PresencePoller6=new p({interval:ba,setupRequest:this.$PresencePoller7.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(l.isOnline()){this.$PresencePoller8=Date.now();this.$PresencePoller9=Date.now();this.$PresencePoller10=Date.now();this.$PresencePoller11=i.updateTime;}else{this.$PresencePoller8=0;this.$PresencePoller11=0;this.$PresencePoller9=0;this.$PresencePoller10=0;}this.$PresencePoller12=0;this.$PresencePoller13('available_initial_data',i.updateTime,i.availableList,i.lastActiveTimes,i.mobileFriends,i.perpetuallyMobileBuddies);u.subscribe((function(ia,ja){if(ja.idleness>ba)this.forceUpdate();}).bind(this));q.subscribe('privacy-user-presence-changed',(function(){this.forceUpdate();}).bind(this));}ga.prototype.start=function(){'use strict';setTimeout(this.$PresencePoller6.start.bind(this.$PresencePoller6),0);};ga.prototype.restart=function(){'use strict';if(this.$PresencePoller6.isMuted()){this.$PresencePoller6.resume();this.forceUpdate();}};ga.prototype.stop=function(){'use strict';this.$PresencePoller6.mute();};ga.prototype.forceUpdate=function(){'use strict';this.$PresencePoller4=true;this.$PresencePoller6.request();};ga.prototype.getIsUserIdle=function(){'use strict';return this.$PresencePoller2;};ga.prototype.getWebChatNotification=function(){'use strict';return this.$PresencePoller3;};ga.prototype.getCallback=function(){'use strict';return this.$PresencePoller1;};ga.prototype.addExtraBuddy=function(ha){'use strict';if(this.$PresencePoller5.indexOf(ha)!==-1)return;this.$PresencePoller5.push(ha);};ga.prototype.$PresencePoller14=function(){'use strict';return v((function(){this.$PresencePoller1(h.ON_AVAILABILITY_CHANGED);}).bind(this),0)();};ga.prototype.$PresencePoller13=function(ha,ia,ja,ka,la,ma){'use strict';this.$PresencePoller11=ia;if(!i.gk_replace_available_list_chatproxy||Object.keys(ja).length!=0)if(!Array.isArray(ja)){r.resetPresenceData();for(var na in ja)r.set(na,ja[na].a,false,ha,ja[na].c);}if(ka&&!Array.isArray(ka))o.update(ka);if(la)r.setMobileFriends(la);if(ma)r.setPerpetuallyMobileBuddies(ma);this.$PresencePoller14();};ga.prototype.$PresencePoller7=function(ha){'use strict';if(x('ChannelConnection',function(la){return la.isShutdown();})||!l.isOnline()){this.$PresencePoller6.skip();j.bumpEntityKey(fa,'skip.offline');return;}if(Date.now()-this.$PresencePoller8<ba){this.$PresencePoller6.skip();j.bumpEntityKey(fa,'skip.recent');return;}j.bumpEntityKey(fa,'request');this.$PresencePoller8=Date.now();var ia=Date.now()-this.$PresencePoller10,ja=t.getCachedProfileIDs().join(","),ka=true;if(i.gk_replace_available_list_chatproxy&&!this.$PresencePoller4&&this.$PresencePoller5.length===0)ka=false;this.$PresencePoller4=false;ha.setHandler(this.$PresencePoller15.bind(this)).setErrorHandler(this.$PresencePoller16.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:m.getID(),cached_user_info_ids:ja,fetch_mobile:ia>aa,additional_buddies:this.$PresencePoller5,get_now_available_list:ka}).setURI(z).setAllowCrossPageTransition(true);};ga.prototype.$PresencePoller15=function(ha){'use strict';var ia=ha.getPayload(),ja=ia.buddy_list;if(!ja){this.$PresencePoller16(ha);return;}j.bumpEntityKey(fa,'response');this.$PresencePoller17();this.$PresencePoller9=Date.now();s.update(ia.time);if(ja.mobile_friends)this.$PresencePoller10=Date.now();this.$PresencePoller12=0;this.$PresencePoller18();var ka=ja.userInfos;if(ka)t.setMulti(ka);var la=ja.chatContexts;la&&k.update(la);this.$PresencePoller2=ja.userIsIdle;if(ja.chatNotif!==undefined&&ja.chatNotif!==this.$PresencePoller3){this.$PresencePoller3=ja.chatNotif;this.$PresencePoller1(h.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller3);}this.$PresencePoller13('buddy_list_poller',ia.time,ja.nowAvailableList,ja.last_active_times,ja.mobile_friends,ja.perpetually_mobile_buddies);};ga.prototype.$PresencePoller16=function(ha){'use strict';j.bumpEntityKey(fa,'error');if(ha.getError()==1356007)return;this.$PresencePoller12++;if(this.$PresencePoller12>=y)this.$PresencePoller1(h.ON_UPDATE_ERROR);};ga.prototype.$PresencePoller18=function(){'use strict';var ha=u.isActive(da)?ba:ca;j.bumpEntityKey(fa,'period.'+ha);this.$PresencePoller6.setInterval(ha);};ga.prototype.$PresencePoller17=function(){'use strict';var ha=Date.now(),ia=ha-this.$PresencePoller9;ea.log('buddylist_presence_stats',babelHelpers._extends({duration:ia},r.getPresenceStats()));};f.exports=ga;},null);
__d("TypingStates",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={INACTIVE:0,TYPING:1,QUITTING:2};f.exports=h;},null);
__d('AvailableList',['Arbiter','ArbiterMixin','AsyncRequest','AvailableListConstants','AvailableListInitialData','BanzaiODS','Bootloader','ChannelConstants','ChatConfig','ChatproxyPresence','ChatproxyPresenceStatus','ChatproxyLastMobileActiveTimes','ChatVisibility','ErrorUtils','JSLogger','LastMobileActiveTimes','PresencePoller','PresencePrivacy','PresenceStatus','Run','ServerTime','ShortProfiles','TypingStates','debounceAcrossTransitions','emptyFunction','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){'use strict';if(c.__markCompiled)c.__markCompiled();m.setEntitySample('presence',.0001);var ha=babelHelpers._extends({},k,i);ha.subscribe([k.ON_AVAILABILITY_CHANGED,k.ON_UPDATE_ERROR],function(sa,ta){h.inform(sa,ta);});var ia=ea(function(){return ha.inform(k.ON_AVAILABILITY_CHANGED);},0);function ja(sa,ta,ua,va,wa){var xa=z.set(sa,ta,ua,va,wa);r.set(sa,ta,ua,va,wa);if(xa){var ya=ea(function(){return ha.inform(k.ON_AVAILABILITY_CHANGED,sa);},0);ya();}}function ka(sa){var ta=sa.payload.availability||{};for(var ua in ta)ja(ua&&ua.toString(),ta[ua].a,true,'mercury_tabs',ta[ua].c,ta[ua].p);}function la(){if(!l.gk_replace_available_list_chatproxy)pa&&pa.restart();}function ma(){if(!l.gk_replace_available_list_chatproxy)pa&&pa.stop();}function na(sa){var ta=ha.getDebugInfo(sa),ua=ta.presence==k.ACTIVE;new j('/ajax/mercury/tabs_presence.php').setData({target_id:sa,to_online:ua,presence_source:ta.overlaySource,presence_time:ta.overlayTime}).setHandler(ka).setErrorHandler(fa).setAllowCrossPageTransition(true).send();}function oa(sa,ta){ta.chat_config=p.getDebugInfo();ta.available_list_debug_info={};z.getAvailableIDs().forEach(function(ua){ta.available_list_debug_info[ua]=ha.getDebugInfo(ua);});ta.available_list_poll_interval=ha._poller&&ha._poller.getInterval();}var pa=undefined,qa=undefined;if(l.gk_replace_available_list_chatproxy){try{qa=new q(function(event){ha.inform(event);});qa.subscribe();}catch(ra){u.reportError&&u.reportError(ra,false);}}else try{pa=new x(function(event){ha.inform(event);});}catch(ra){u.reportError&&u.reportError(ra,false);}Object.assign(ha,{getChatproxyPresenceObject:function(){return qa;},getPresencePollerObject:function(){return pa;},get:function(sa){return z.get(sa);},updateForID:function(sa){na(sa);if(l.gk_replace_available_list_chatproxy){if(y.getVisibility()==y.ONLINE)aa.onAfterLoad(function(){return (n.loadModules(["ChannelManager","ChannelTransport"],function(ta,ua){ua.sendAdditionalBuddyRequest(ta.getCompleteConfig(),sa);}));});}else pa&&pa.addExtraBuddy(sa);},getWebChatNotification:function(){if(l.gk_replace_available_list_chatproxy){return qa&&qa.getWebChatNotification&&qa.getWebChatNotification();}else return pa&&pa.getWebChatNotification&&pa.getWebChatNotification();},isUserIdle:function(){if(!l.gk_replace_available_list_chatproxy)return pa&&pa.getIsUserIdle();},isReady:function(){if(!l.gk_replace_available_list_chatproxy)return !!pa;return !!qa;},set:function(sa,ta,ua,va){ja(sa,ta,true,ua,va);},update:function(){if(!l.gk_replace_available_list_chatproxy)pa&&pa.forceUpdate();},isIdle:function(sa){return ha.get(sa)==k.IDLE;},getDebugInfo:function(sa){var ta=z.getDebugInfo(sa),ua=ca.getNow(sa);if(ua)ta.name=ua.name;return ta;}});if(!l.gk_replace_available_list_chatproxy)pa&&pa.start();h.subscribe(v.DUMP_EVENT,oa);h.subscribe('chat-visibility/go-online',la);h.subscribe('chat-visibility/go-offline',ma);y.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ia);ga('ChannelConnection',function(sa){return (sa.subscribe([sa.CONNECTED,sa.RECONNECTING,sa.SHUTDOWN,sa.MUTE_WARNING,sa.UNMUTE_WARNING],ia));});h.subscribe(o.getArbiterType('buddylist_overlay'),function(sa,ta){var ua={},va=ta.obj.overlay;for(var wa in va){ha.set(wa,va[wa].a,va[wa].s||'channel',va[wa].vc);if(va[wa].la)ua[wa]=va[wa].la;}w.update(ua);s.update(ua);});h.subscribe([o.getArbiterType('typ'),o.getArbiterType('ttyp')],function(sa,ta){var ua=ta.obj;if(ua.st===da.TYPING){var va=ua.from;if(t.isOnline()){m.bumpEntityKey('presence','stale_presence_check_typing');var wa=z.get(va);if(wa!=k.ACTIVE){var xa=w.get(va)*1000,ya=ba.get();if(!xa){m.bumpEntityKey('presence','no_detailed_presence_typing');}else if(ya-xa>5*60*1000){var za='stale_presence_typing',ab=ya-xa;if(ab<10*60*1000){za+='600';}else if(ab<60*60*1000)za+='3600';m.bumpEntityKey('presence',za);}}}ha.set(va&&va.toString(),k.ACTIVE,'channel-typing');}});h.subscribe(o.getArbiterType('messaging'),function(sa,ta){if(!t.isOnline())return;var ua=ta.obj;if(ua.message&&ua.message.timestamp&&ua.message.sender_fbid){var va=ba.get(),wa=ua.message.timestamp;if(va-wa<2*60*1000){m.bumpEntityKey('presence','stale_presence_check');var xa=ua.message.sender_fbid,ya=z.get(xa);if(ya==k.ACTIVE)return;var za=w.get(xa)*1000;if(!za){m.bumpEntityKey('presence','no_detailed_presence');}else if(wa-za>5*60*1000){var ab='stale_presence',bb=wa-za;if(bb<10*60*1000){ab+='600';}else if(bb<60*60*1000)ab+='3600';m.bumpEntityKey('presence',ab);}}}});b.AvailableList=f.exports=ha;},null);
__d('FBRTCDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('FBRTCLogger',['Log','LogHistory','MarauderLogger','formatDate','pageID'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='webrtc',n='sent_message',o='received_message',p='send_succeeded',q='send_failed',r='info',s='call_action',t='client_event',u='client_error',v='type',w='msg_id',x='ack_msg_id',y='call_id',z='from',aa='to',ba='content',ca='tag',da='peer_id',ea='error_code',fa='trigger',ga='endcallstats',ha=null;ia.getInstance=function(){'use strict';if(!ha)ha=new ia();return ha;};function ia(){'use strict';this.$FBRTCLogger1=i.getInstance(m);}ia.prototype.logToConsole=function(ja){'use strict';var ka='Console';this.$FBRTCLogger2(null,null,ka,ja);this.$FBRTCLogger1.log(ka,ja);};ia.prototype.logReceivedMessage=function(ja,ka,la){'use strict';var ma={};ma[z]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(o,ma);this.$FBRTCLogger2(ja,ka,'Received',la.type+', '+la.msg_id);};ia.prototype.logSentMessage=function(ja,ka,la){'use strict';var ma={};ma[aa]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(n,ma);this.$FBRTCLogger2(ja,ka,'Sent',la.type+', '+la.msg_id);};ia.prototype.logSentMessageSuccess=function(ja,ka,la,ma){'use strict';var na={};na[da]=ja;na[y]=ka;na[v]=la;na[w]=ma;this.$FBRTCLogger3(p,na);};ia.prototype.logSentMessageFailure=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[v]=la;oa[w]=ma;oa[ea]=na;this.$FBRTCLogger3(q,oa);this.$FBRTCLogger2(ja,ka,'Send Failed',la+', '+na);};ia.prototype.logCallAction=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[s]=la;oa[ba]=ma;if(na)oa[fa]=na;this.$FBRTCLogger3(s,oa);this.$FBRTCLogger2(ja,ka,'CallAction',la+', '+ma);};ia.prototype.logEvent=function(ja,ka,event){'use strict';var la={};la[da]=ja;la[y]=ka;la[ba]=event;this.$FBRTCLogger3(t,la);this.$FBRTCLogger2(ja,ka,'Event',event);};ia.prototype.logInfo=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(r,ma);this.$FBRTCLogger2(ja,ka,'Info',la);};ia.prototype.logError=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(u,ma);this.$FBRTCLogger2(ja,ka,'Error',la);};ia.prototype.logErrorWithoutID=function(ja){'use strict';this.logError(null,null,ja);};ia.prototype.logEndCallSummary=function(ja){'use strict';if(!ja)return;var ka={};ka[da]=ja.peerID;ka[y]=ja.callID;ka[ca]=ga;ka[ba]=ja.toString();var la=ja.getExtraInfo();for(var ma in la)if(la.hasOwnProperty(ma))ka[ma]=la[ma];this.$FBRTCLogger3(r,ka);this.$FBRTCLogger2(ja.peerID,ja.callID,'Call Summary',ka);};ia.prototype.$FBRTCLogger3=function(ja,ka){'use strict';ka.page_id=l;this.$FBRTCLogger1.log(ja,ka);j.log(ja,m,ka);};ia.prototype.$FBRTCLogger2=function(ja,ka,la,ma){'use strict';};ia.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};ia.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown',RESET_CALL:'install_screen_sharing_ext_dialog'};ia.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};f.exports=ia;},null);
__d('FBRTCLocalMessageQueue',['CacheStorage','FBRTCLogger','Map','RTCConfig'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l='localstorage',m='RTC_',n='offer',o='offer_msg',p='data_',q=30*1000,r=15*1000,s=500,t=new j();function u(){'use strict';this.$FBRTCLocalMessageQueue1=i.getInstance();}u.prototype.enqueueOffer=function(v,w){'use strict';var x=this.$FBRTCLocalMessageQueue2(v,o);this.$FBRTCLocalMessageQueue3(x,n,w);};u.prototype.getOffer=function(v){'use strict';var w=this.$FBRTCLocalMessageQueue2(v,o);return this.$FBRTCLocalMessageQueue4(w,n);};u.prototype.removeOffer=function(v){'use strict';var w=this.$FBRTCLocalMessageQueue2(v,o);w.remove(n);};u.prototype.enqueueMessage=function(v,w,x,y){'use strict';var z=p+x.toString();if(k.LocalstorageRolloutGK){var aa=t.get(v)||new j();aa.set(z,y);t.set(v,aa);}else{var ba=this.$FBRTCLocalMessageQueue2(v,w);this.$FBRTCLocalMessageQueue3(ba,z,y);}this.$FBRTCLocalMessageQueue1.logToConsole('Queued '+z);};u.prototype.drainQueue=function(v,w){'use strict';var x=t.get(v)||new j(),y,z;for(var aa=x,ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){if(ba){if(ca>=aa.length)break;var da=aa[ca++];y=da[0];z=da[1];}else{ca=aa.next();if(ca.done)break;var ea=ca.value;y=ea[0];z=ea[1];}void y;w(z);}t.set(v,new j());};u.prototype.enableDequeuing=function(v,w,x,y){'use strict';if(y===undefined)y=r;this.$FBRTCLocalMessageQueue5(v,w,x,y);};u.prototype.$FBRTCLocalMessageQueue5=function(v,w,x,y){'use strict';var z=this.$FBRTCLocalMessageQueue2(v,w),aa=z.keys(),ba=aa.length;for(var ca=0;ca<ba;ca++){var da=this.$FBRTCLocalMessageQueue6(z,aa[ca]);if(da&&x)x(da);}this.$FBRTCLocalMessageQueue1.logToConsole('Dequeued '+ba+' ('+v+') with '+y+' left)');if(y>0){y-=s;setTimeout((function(){this.$FBRTCLocalMessageQueue5(v,w,x,y);}).bind(this),s);}};u.prototype.$FBRTCLocalMessageQueue3=function(v,w,x){'use strict';var y={__t:Date.now(),__d:x};v.set(w,y);};u.prototype.$FBRTCLocalMessageQueue4=function(v,w){'use strict';var x=v.get(w);if(x&&this.$FBRTCLocalMessageQueue7(x)){return x.__d;}else if(x)v.remove(w);return null;};u.prototype.$FBRTCLocalMessageQueue6=function(v,w){'use strict';var x=this.$FBRTCLocalMessageQueue4(v,w);if(x!==null){v.remove(w);return x;}return null;};u.prototype.$FBRTCLocalMessageQueue7=function(v){'use strict';return Date.now()-v.__t<q;};u.prototype.$FBRTCLocalMessageQueue2=function(v,w){'use strict';return new h(l,''+m+v+'_'+w+'_');};f.exports=u;},null);
__d('FBRTCCallControlActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({ACCEPT_ESCALATION:null,HANG_UP:null,PARENT_WINDOW_START_CALL:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,TOGGLE_SELF_VIEW:null,SHOW_SETTINGS:null,START_CALL:null,DECLINE_ESCALATION:null,RECEIVED_SIGNALING_MESSAGE:null,RESET_CALL:null,OPEN_SCREEN_IN_NEW:null,CLOSE_STANDALONE_SCREEN:null}),k={Types:j,hangUp:function(){h.dispatch({type:j.HANG_UP});},toggleMuteAudio:function(){h.dispatch({type:j.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){h.dispatch({type:j.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){h.dispatch({type:j.TOGGLE_FULL_SCREEN});},toggleSelfView:function(){h.dispatch({type:j.TOGGLE_SELF_VIEW});},showSettings:function(){h.dispatch({type:j.SHOW_SETTINGS});},toggleScreenSharing:function(){h.dispatch({type:j.TOGGLE_SCREEN_SHARING});},startCall:function(){h.dispatch({type:j.START_CALL});},openScreenInNewWindow:function(){h.dispatch({type:j.OPEN_SCREEN_IN_NEW});},receivedSignalingMessage:function(l){h.dispatch({type:j.RECEIVED_SIGNALING_MESSAGE,message_type:l.msgType,message:l});},acceptEscalation:function(){h.dispatch({type:j.ACCEPT_ESCALATION});},declineEscalation:function(){h.dispatch({type:j.DECLINE_ESCALATION});},resetCall:function(l){h.dispatch({type:j.RESET_CALL,trigger:l});},parentWindowStartCall:function(){h.dispatch({type:j.PARENT_WINDOW_START_CALL});}};f.exports=k;},null);
__d('FBRTCSupport',['ChannelConstants','RTCConfig','UserAgent'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={isSendWebrtcSupported:function(){return i.SendNewVCGK;},isReceiveWebrtcSupported:function(){return i.ReceiveNewVCGK;},isVideoInteropSupported:function(){return i.VideoInteropGK;},isVideoCallBlockingSupported:function(){return i.VideoCallBlockingGK;},isWebrtcSupported:function(){return (j.isBrowser('Chrome >= 28')||j.isBrowser('Firefox >= 25')||j.isBrowser('Opera >= 20'));},isOSSupported:function(){return !j.isPlatform('Android')&&!j.isPlatform('iOS');},getCapabilities:function(){var l=0;if(this.isReceiveWebrtcSupported())l=h.CAPABILITY_VOIP_INTEROP;return l;}};f.exports=k;},null);
__d('FBRTCMessageListener',['Arbiter','ChannelConstants','FBRTCCallControlActions','FBRTCLocalMessageQueue','FBRTCSupport','RTCConfig','guid','invariant','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=45*1000,r='rtc_child_window_ready',s='rtc_child_window_start_call',t='rtc_child_window_message',u=[],v=null,w=null,x=null,y=null,z=null,aa=false,ba=null,ca={init:function(da,ea){if(aa)return;aa=true;h.subscribe(i.getArbiterType('webrtc'),(function(ga,ha){this._onMessage(ha.obj);}).bind(this));if(m.RtcConferencingGK)h.subscribe(i.getArbiterType('rtc_multi_json'),(function(ga,ha){this._onMultiwayMessage(ha.obj);}).bind(this));this._localMessageQueue=new k();if(m.PassMessagesBetweenWindowsGK){if(l.isWebrtcSupported()&&window.addEventListener){var fa=da?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener('message',fa,false);}if(da)this._connectToParentWindow(ea);}},setParentWindowNonce:function(da){y=da;},generateNewNonce:function(){z=n();return z;},setMultiwayMessageHandler:function(da,ea){!!ba?o(0):undefined;ba=ea?da.bind(ea):da;},_onMultiwayMessage:function(da){this.emit('multiwayMessageReceived',da);if(ba)ba(da);},setMessageHandler:function(da,ea){!!v?o(0):undefined;v=ea?da.bind(ea):da;while(u.length)v(u.shift());},removeMessageHandler:function(){v=null;},_onMessage:function(da){this.emit('messageReceived',da);if(v){v(da);}else u.push(da);this._passMessageToChildWindow(da);},_connectToParentWindow:function(da){if(window.opener&&window.opener.postMessage){var ea={type:r,nonce:y,childNonce:this.generateNewNonce(),peerID:da};window.opener.postMessage(ea,window.location.origin);}},_verifyWindowMessage:function(event){return event.origin===window.location.origin&&event.data&&z&&event.data.nonce===z;},_handleWindowMessageToParent:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===r){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);if(m.LocalstorageRolloutGK)this._replayQueuedMessagesToChild(event.data.peerID,w);}},_handleWindowMessageToChild:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===t)this._onMessage(event.data.message);if(event.data.type===s)j.parentWindowStartCall();},_replayQueuedMessagesToChild:function(da,ea){this._localMessageQueue.drainQueue(da,function(fa){var ga={type:t,nonce:y,message:fa};ea.postMessage(ga,window.location.origin);});},_setChildWindow:function(da){w=da;clearTimeout(x);x=setTimeout(function(){w=null;},q);this._startCallInChildWindow();this.generateNewNonce();},_passMessageToChildWindow:function(da){if(w){var ea={type:t,nonce:y,message:da};w.postMessage(ea,window.location.origin);}},_startCallInChildWindow:function(){if(w){var da={type:s,nonce:y};w.postMessage(da,window.location.origin);}}};p(ca,{messageReceived:true,multiwayMessageReceived:true});f.exports=ca;},null);