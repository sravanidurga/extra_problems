/*!CK:3077514960!*//*1448917389,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["B1cm1"]); }

__d("MessagesViewerSetID",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};},null);
__d("MessagingGenericAdminTextType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONFIRM_FRIEND_REQUEST:"confirm_friend_request",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message"};},null);
__d("StickerAssetType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={IMAGE:"BestEffortImage",SPRITE:"SpriteImage",PADDED_SPRITE:"PaddedSpriteImage"};},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(t,u,v){this.xhr=n();if(!(u instanceof l))u=new l(u);if(v&&t=='GET'){u.setQueryData(v);}else this._params=v;this.method=t;this.uri=u;this.xhr.open(t,u);}var q=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();p.supportsCORS=function(){return q;};p.ERROR='ar:error';p.TIMEOUT='ar:timeout';p.PROXY_ERROR='ar:proxy error';p.TRANSPORT_ERROR='ar:transport error';p.SERVER_ERROR='ar:http error';p.PARSE_ERROR='ar:parse error';p.SERVICE_UNAVAILABLE='ar:noservice';p._inflight=[];function r(){var t=p._inflight;p._inflight=[];t.forEach(function(u){u.abort();});}function s(t){t.onJSON=t.onError=t.onSuccess=null;clearTimeout(t._timer);if(t.xhr&&t.xhr.readyState<4){t.xhr.abort();t.xhr=null;}p._inflight=p._inflight.filter(function(u){return u&&u!=t&&u.xhr&&u.xhr.readyState<4;});}Object.assign(p.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(t){if(this[t])this[t](this);},_parseStatus:function(){var t;try{this.status=this.xhr.status;t=this.xhr.statusText;}catch(u){if(this.xhr.readyState>=4){this.errorType=p.TRANSPORT_ERROR;this.errorText=u.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=p.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=p.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=p.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=p.SERVER_ERROR;}else if(this.status===503){this.errorType=p.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=p.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=p.TRANSPORT_ERROR;}else{t='unrecognized status code: '+this.status;this.errorType=p.ERROR;}if(!this.errorText)this.errorText=t;},_parseResponse:function(){var t,u=this.xhr.readyState;try{t=this.xhr.responseText||'';}catch(v){if(u>=4){this.errorType=p.ERROR;this.errorText='responseText not available - '+v.message;}return;}while(this.xhr){var w=this._eol+1,x=this.streamMode?t.indexOf('\n',w):t.length;if(x<0&&u==4)x=t.length;if(x<=this._eol)break;var y=t;if(this.streamMode)y=t.substr(w,x-w).replace(/^\s*|\s*$/g,'');if(w===0&&this.prelude)if(this.prelude.test(y))y=y.replace(this.prelude,'');this._eol=x;if(y){try{this.json=JSON.parse(y);}catch(v){var z=/(<body[\S\s]+?<\/body>)/i.test(t)&&RegExp.$1,aa={message:v.message,'char':w,excerpt:(w===0&&z||y).substr(512)};this.errorType=p.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(aa);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var t=this.xhr&&this.xhr.readyState||0;if(this.status==null&&t>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(t==3&&this.streamMode||t==4)this._parseResponse();if(this.errorType||t==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');s(this);}},send:function(t){this.xhr.onreadystatechange=k.guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var u=this.timeout;if(u)this._timer=o((function(){this.errorType=p.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');s(this);}).bind(this),u);p._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(t?j.serialize(t):'');},abort:function(){s(this);},toString:function(){var t='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)t+=' errorType='+this.errorType+' ('+this.errorText+')';return t+']';},toJSON:function(){var t={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)t.uri=this.uri;for(var u in t)if(t[u]==null)delete t[u];return t;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',r);f.exports=p;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_apis:{},_dispatch:function(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(i._apis.hasOwnProperty(j.api)){var m=i._apis[j.api];if(m[j.method])k=h.applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function(j,k){i._apis[k]=j;},proxy:function(j,k,l){var m={};l.forEach(function(n){m[n]=function(){var o={api:k,method:n,args:Array.prototype.slice.call(arguments)},p;try{if(j.closed)throw new Error('DocRPC window closed');p=j.DocRPC._dispatch(JSON.stringify(o));}catch(q){h.reportError(q);return;}if(typeof p=='string')try{p=JSON.parse(p);}catch(q){throw new Error('DocRPC '+k+'.'+n+' unparsable return: "'+p+'"');}return p;};});return m;}};f.exports=b.DocRPC=i;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.getInstance('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(ba,ca){var da=ba.subdomain;da=da===null?'':da+'-';var ea=ba.host;ea=ea===null||ea===undefined?'edge-chat':ba.host;var fa=new m(ca).setDomain(da+ea+'.'+ba.domain).setPort(ba.port).setSecure(new m(window.location.href).isSecure());return fa;}function s(ba){var ca={partition:ba.partition,cb:q(),failure:ba.pingFailuresOnSubdomain};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;var da=r(ba,'/p').setQueryData(ca);p.log('start_p',{uri:da.toString()});var ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;var fa=function(ga){p.log('finish_p',{xhr:ga.toJSON?ga.toJSON():ga,subdomain:ba.subdomain,fullHost:ba.fullHost});};ea.onError=function(ga){fa(ga);if(ba.subdomain===null)return;ba.pingFailuresOnSubdomain++;ba.subdomain++;if(ba.subdomain>6)ba.subdomain=0;};ea.timeout=ba.P_TIMEOUT;ea.onSuccess=fa;ea.send();}function t(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=l.guard(function(){p.log('ping_ok',{duration:Date.now()-fa});ga(true);},'ChannelTransport image.onload');ea.onerror=l.guard(function(){s(ba);ga(false);},'ChannelTransport image.onerror');var ha=o(ea.onerror,10000);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:q()};if(ba.sticky_token)ia.sticky_token=ba.sticky_token;if(ba.sticky_pool)ia.sticky_pool=ba.sticky_pool;if(ba.lastRequestErrorReason){ia.reason=ba.lastRequestErrorReason;ba.lastRequestErrorReason=null;}if(ba.uid&&ba.viewerUid){ia.uid=ba.uid;ia.viewer_uid=ba.viewerUid;}if(ba.watchdog&&ba.watchdog.enabled)ia.wtc=ba.watchdog.doSerialize();fa=Date.now();ea.src=r(ba,'/ping').setQueryData(ia);return ea;}function u(ba,ca){var da={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)da.sticky_token=ba.sticky_token;if(ba.sticky_pool)da.sticky_pool=ba.sticky_pool;if(ba.profile)da.profile=ba.profile;if(ba.capabilities)da.cap=ba.capabilities;da.id=ca;var ea=r(ba,'/add_bud').setQueryData(da),fa=new h('GET',ea);if(h.supportsCORS())fa.xhr.withCredentials=true;fa.onError=function(ga){p.warn('add_buddy_error');};fa.onSuccess=function(ga){p.log('add_buddy_ok');};fa.timeout=ba.P_TIMEOUT;fa.send();}function v(ba){var ca={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;if(ba.is_offline||ba.shouldSuppressPresence){ca.state='offline';}else ca.state='active';if(ca.state===ba.lastPresenceState)return;ba.lastPresenceState=ca.state;if(ba.profile)ca.profile=ba.profile;if(ba.capabilities)ca.cap=ba.capabilities;var da=r(ba,'/active_ping').setQueryData(ca),ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;ea.onError=function(fa){p.warn('active_ping_error');};ea.onSuccess=function(fa){p.log('active_ping_ok');};ea.timeout=ba.P_TIMEOUT;ea.send();}function w(ba,ca,da,ea){var fa=new Date(),ga=-1;if(ba.userActive>0){ga=(fa-ba.userActive)/1000|0;if(ga<0)p.warn('idle_regression',{idleTime:ga,now:fa.getTime(),userActive:ba.userActive});}var ha={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:q(),idle:ga,qp:'y',cap:0};if(!!ba.watchdog&&ba.watchdog.enabled)ha.wtc=ba.watchdog.doSerialize();if(ba.ready)if(ba.seqTurSentAt==-1||ba.seqTurSentAt==ba.seq){ha.tur=ba.timeUntilReady;ha.qpmade=ba.queueMade;ba.seqTurSentAt=ba.seq;}if(ba.sequenceId>0)ha.isq=ba.sequenceId;ha.msgs_recv=ba.estimatedReceived;if(ba.uid&&ba.viewerUid){ha.uid=ba.uid;ha.viewer_uid=ba.viewerUid;}if(ba.sticky_token){ha.sticky_token=ba.sticky_token;}else{if(ba.requestBatchedPull)ha.request_batch=1;if(ba.msgr_region)ha.msgr_region=ba.msgr_region;}if(ba.sticky_pool)ha.sticky_pool=ba.sticky_pool;if('trace_id' in ba)ha.traceid=ba.trace_id;if(ba.is_offline||ba.shouldSuppressPresence){ha.state='offline';}else if(ba.userActive>0&&ga<60)ha.state='active';ba.lastPresenceState=ha.state;if(ba.streamingCapable){ha.mode='stream';ha.format='json';}if(ba.profile)ha.profile=ba.profile;if(ba.capabilities)ha.cap=ba.capabilities;var ia=r(ba,'/pull').setQueryData(ha),ja=ba.fantail_enabled?'POST':'GET',ka=new h(ja,ia);if(h.supportsCORS())ka.xhr.withCredentials=true;ka.timeout=ba.streamingCapable?ba.STREAMING_TIMEOUT:ba.LONGPOLL_TIMEOUT;ka.onJSON=ca;ka.onSuccess=da;ka.onError=function(){var na=this.status==12002&&this._time>=ba.MIN_12002_TIMEOUT||this.status==504&&this._time>=ba.MIN_504_TIMEOUT,oa=na?da:ea;return oa&&oa.apply(this,arguments);};if(ba.fantail_logs&&ba.fantail_logs.length>0){var la={};for(var ma=0;ma<ba.fantail_logs.length;ma++)Object.assign(la,ba.fantail_logs[ma]);ka.send(la);ba.fantail_logs=[];}else ka.send();ba.inStreaming=ba.streamingCapable;return ka;}function x(ba){this.manager=ba;this.init&&this.init();}function y(ba){x.apply(this,arguments);}Object.assign(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')o(n(this.manager,'exitState',{status:i.OK,stateId:ca.stateId}),ca.fullReloadAsSuccess?0:3000);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=t(ca,n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(da,'_processTransportData',ca.stateId),n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});function z(ba){p.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(z.prototype,{logName:'iframe',_initIframe:function(ba){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(ba){this._iframeURI=r(ba,ba.path);if(ba.resources){var ca=this._iframeURI.getDomain();ba.resources=ba.resources.map(function(fa){var ga=new m(fa);if(ga.getPath().startsWith('/intern/rsrc.php')&&ga.getQueryData().origin!==undefined)return ga.addQueryData('origin',ca).toString();return fa;});}if(ba.bustIframe){var da={partition:ba.partition,cb:q()};this._iframeURI.setQueryData(da);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ea){p.error('iframe_uri_set_error',ea);this.exitState({status:i.ERROR,stateId:ba.stateId},ea+'');}},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:i.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}Object.assign(aa.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var ca=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,ca);this.exitState({status:i.OK,stateId:1e+06});}catch(ba){p.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=t(ca,n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(this,'_processTransportData',ca.stateId),n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});f.exports={getURI:r,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa,sendActivePing:v,sendAdditionalBuddyRequest:u};},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m){m=babelHelpers._extends({},i(k),m);var n=new h(k,l,m);n.streamMode=false;var o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};n.ajaxReqSend=n.send;n.send=function(p){this.ajaxReqSend(babelHelpers._extends({},p,m));};return n;}f.exports=j;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatConfig','ChatVisibility','DTSG','Env','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','Run','SystemEvents','URI','UserActivity','createArrayFromMixed','errorCode','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){if(c.__markCompiled)c.__markCompiled();var na,oa=w.create('channel'),pa=x.getInstance('channel_manager'),qa=null;function ra(fb){qa=fb;}var sa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ta={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,estimatedReceived:0,fantail_logs:[],sessionID:k.getID(),capabilities:u.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:ba.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},ua={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var fb=this.accumulatedPullTimeMillis,gb=Date.now();if(this.pullStartTimeMillis>0&&gb-this.pullStartTimeMillis<=ta.LONGPOLL_TIMEOUT)fb+=gb-this.pullStartTimeMillis;var hb=fb/1000;if(hb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return hb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(fb,gb){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=Date.now()-this.pullStartTimeMillis;if(fb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(fb){return fb.indexOf('pull')===0||fb.indexOf('init')===0||fb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var fb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)fb+=Date.now()-this.timeInGoodStatesStartMillis;return fb/1000;},clientEnteredState:function(fb){if(!this.enabled)return;var gb=this.isGoodState(fb);if(gb&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!gb&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(fb){if(!this.enabled)return;if(fb.indexOf('pull')===0){this.reportPullSent();}else if(fb.indexOf('ping')===0&&ta.lastRequestErrorReason!==l.SYS_TIMETRAVEL&&ta.lastRequestErrorReason!==l.SYS_ONLINE&&ta.lastRequestErrorReason!==l.SYS_OWNER&&ta.lastRequestErrorReason!==l.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return '';return this.getTimeSinceFirstPullSentSeconds().toFixed(0)+','+this.getAccumulatedPullTimeSeconds().toFixed(0)+','+this.getPingToPullRatio().toFixed(3)+','+this.getUptimeSeconds().toFixed(0)+','+this.getTotalTimeInGoodStatesSeconds().toFixed(0);}},va=1,wa={},xa=0;function ya(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function za(){var fb={};if(na.getConfig('host'))fb[na.getConfig('user_channel')]=na.getConfig('seq',0);return fb;}function ab(){var fb=Date.now(),gb=Date.now(),hb={total:0},ib='idle',jb=false;fa.subscribe([fa.USER,fa.ONLINE,fa.TIME_TRAVEL],function(mb,nb){cb(true);gb=null;na.lastPullTime=Date.now();var ob;switch(mb){case fa.USER:ob=fa.isPageOwner()?l.SYS_OWNER:l.SYS_NONOWNER;break;case fa.ONLINE:ob=nb?l.SYS_ONLINE:l.SYS_OFFLINE;break;case fa.TIME_TRAVEL:ob=l.SYS_TIMETRAVEL;break;}na.exitState({status:ob,stateId:va});});var kb=function(mb,nb){var ob=Date.now(),pb=null;if(nb){fb=ob;pb=nb.nextState||nb.state;}else pb=ib;fa.checkTimeTravel();if(gb){var qb=Math.round((ob-gb)/1000);if(qb>0){hb[ib]=(hb[ib]||0)+qb;hb.total+=qb;}}ib=pb;gb=ob;if(!mb){hb.lastSuccessTime=ya();hb.online=fa.isOnline();pa.log('rollup',hb);}};i.subscribe(l.ON_ENTER_STATE,kb);la(kb,60000);i.subscribe(w.DUMP_EVENT,function(mb,nb){nb.channelRollup=hb;});var lb=function(){if(na.isShutdown()||na.shouldIdle())return;fa.checkTimeTravel();var mb=Date.now()-(na.lastPullTime||s.start);if(!jb&&mb>ta.STALL_THRESHOLD){var nb=ya();pa.error('stall',{lastSuccessTime:nb,rollupState:ib});jb=true;}var ob=Date.now()-fb;if(na.state=='pull'&&ob>ta.JUMPSTART_THRESHOLD){fb=null;pa.warn('jumpstart',{state:na.state,dormant:ob});na.enterState('init');}};la(lb,10000);}function bb(){var fb=Date.now(),gb=1;function hb(){ma(hb,gb*1000);var mb=na.state;if(mb=='idle'&&na.shouldIdle())return;oa.bump('conn_t',gb);if(mb=='pull')oa.bump('conn_t_pull',gb);}hb();var ib=[15,30,60,120,240],jb=false,kb=false;function lb(mb){ma(function(){oa.rate('pullenter_'+mb,jb);oa.rate('pullexit_'+mb,kb);},mb*1000);}while(ib.length)lb(ib.shift());i.subscribe(l.ON_ENTER_STATE,function(mb,nb){if(nb.state=='pull')jb=true;fb=Date.now();});i.subscribe(l.ON_EXIT_STATE,function(mb,nb){if(nb.state!='pull'||!fb)return;var ob='other';if(nb.status==l.OK){kb=true;ob='ok';}else if(nb.xhr&&nb.xhr.errorType){ob=/ar:(\w+)/.test(nb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(nb.status))return;var pb=(Date.now()-fb)/1000;if(pb<0){return;}else if(pb>3600)pb=3600;oa.bump('conn_num');oa.bump('conn_exit',pb);oa.bump('conn_num_'+ob);oa.bump('conn_exit_'+ob,pb);});}function cb(fb){if(fb){xa=0;wa={};}else xa++;}function db(){var fb=!h.supportsCORS()||ta.forceIframe;if(ta.subdomain===null||fb){ta.fullHost=ta.host;}else ta.fullHost=ta.subdomain+'-'+ta.host;}na={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:ra,backoff:false,sessionRegistered:false,init:function(fb,gb){this.init=function(){};i.subscribe(l.GET_RTI_SESSION_REQUEST,(function(event,kb){this.informCurrentSession();}).bind(this));ka((function(){this._logFantail('client initialized',l.FANTAIL_INFO);this._logFantail('using session id: '+ta.sessionID+' at seq: '+ta.sequenceId+' with sticky:'+ta.sticky_token+'/'+ta.sticky_pool,l.FANTAIL_INFO);ua.enabled=!!ta.watchdog_enabled;ta.watchdog=ua;ha.subscribe(function(){ta.userActive=Date.now();o.sendActivePing(ta);});}).bind(this));aa.register('ch',za);var hb=this.getConfig('max_conn',2);ta.subdomain=n.allocate(hb);this._transportRate=new z(30000);var ib=h.supportsCORS()&&!ta.forceIframe?'CORSTransport':'IframeTransport';this.transport=new o[ib](this);if(fb)this.enterState(fb,gb);ka((function(){i.subscribe(w.DUMP_EVENT,(function(event,kb){kb.transportRate=this._transportRate.tally();kb.transportType=ib;kb.transportVersion=2;}).bind(this));ab();bb();}).bind(this));if(na.getConfig('tryStreaming')&&na.getConfig('host')&&h.supportsCORS()&&!ta.forceIframe){var jb=ta.MIN_INIT_PROBE_DELAY+Math.random()*ta.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ma(this._probeTest,jb);}},configure:function(){var fb=ia(arguments);pa.log('configure',fb);fb.forEach(function(gb){return Object.assign(ta,gb);});db();i.inform(l.ON_CONFIG,this);},getConfig:function(fb,gb){return fb in ta?ta[fb]:gb;},getCompleteConfig:function(){return ta;},informCurrentSession:function(){var fb=null;if(this.sessionRegistered&&ta&&ta.fullHost&&ta.sticky_token&&ta.uid)fb=new da(ta.fullHost,ta.port,ta.sticky_pool,ta.sticky_token,ta.uid,ta.viewerUid,ta.profile,ta.sessionID,ta.capabilities);i.inform(l.RTI_SESSION,fb);},getWatchdog:function(){return ua;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(fa.isPageOwner()&&fa.isOnline());},_sendIframeError:function(fb){var gb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:fb,fb_dtsg:r.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);gb.specifiesWriteRequiredParams()&&gb.send();},_getDelay:function(){var fb=Math.min(ta.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,xa-1)),ta.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in ta)fb=ta.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(fb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)pa.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(fb){this._inEnterState=false;throw fb;}},_enterState:function(fb){if((fb.indexOf('pull')===0||fb.indexOf('ping')===0||fb.indexOf('shutdown')===0)&&!!ta.active_config_refresh){var gb=Date.now(),hb=(gb-ta.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in ta&&ta.config_refresh_seconds>0&&hb>ta.config_refresh_seconds){fb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',l.FANTAIL_DEBUG);}}if(fb.indexOf('reconnect')===0)ta.reconnectOverrideTimeMillis=Date.now();var ib=this.backoff?this._getDelay():0;this.backoff=false;var jb=ia(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+fb,l.FANTAIL_WARN);return;}if(fb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',l.FANTAIL_WARN);return;}va++;ta.stateId=va;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(fb)){var kb=this._transportRate.tally().timeAverage,lb=na.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(kb>=lb){if(!this._throttled){this._throttled=true;pa.warn('throttled');}oa.bump('throttle');ib=1000/lb;}}else if(!(/#$/.test(fb)))ib=this._getDelay();fb=fb.replace(/\W*$/,'');if(!sa[fb]){this._logFantail('invalid state: '+fb,l.FANTAIL_ERROR);throw new Error('invalid state:'+fb);}var mb;if(ib<=0){mb={state:fb};this._transportRate.add(1);this.state=fb;var nb=this['_enter_'+this.state];if(nb){jb.shift();nb.apply(this,jb);}if(/init|idle|pull|ping/.test(this.state)){if(ta.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];ua.transportEnteredState(fb);ua.clientEnteredState(fb);ta.is_offline=!q.isOnline();ta.capabilities=u.getCapabilities();this._logFantail('entering transport state: '+this.state,l.FANTAIL_INFO);this.transport.enterState(this.state,ta);if(this.state=='ping'){mb.url=o.getURI(ta).toString();mb.port=ta.port||'undefined';}}}else{this.state='idle';this.nextState=fb;mb={state:this.state,delay:ib,nextState:fb};jb[0]=fb+'#';this._deferredTransition=ma((function(){this._deferredTransition=null;this.enterState.apply(this,jb);}).bind(this),ib);}if(/pull/.test(fb)){mb.client_id=ta.sessionID;mb.streaming=ta.inStreaming;}pa.log('enter_'+this.state,mb);i.inform(l.ON_ENTER_STATE,mb);},exitState:function(fb,gb){var hb=fb.stateId,ib=fb.status;if((ib==l.SYS_TIMETRAVEL||ib==l.SYS_ONLINE||ib==l.SYS_NONOWNER||ib==l.SYS_OWNER)&&ua)ua.initialize();if(this.isShutdown()||hb<va)return;var jb=ia(arguments),kb=this.state;jb[0]=fb.status;var lb={state:kb,status:ib};if(/pull/.test(kb)){lb.client_id=ta.sessionID;lb.streaming=ta.inStreaming;}if(/ping/.test(kb)&&ib!=l.OK)lb.url=o.getURI(ta).toString();if(this.nextState)lb.nextState=this.nextState;if(gb&&gb.errorType){ta.lastRequestErrorReason=gb.errorType;lb.xhr=gb.toJSON?gb.toJSON():gb;if(gb.errorType==h.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',l.FANTAIL_ERROR);this.proxyDown=true;}delete lb.xhr.json;}else if(ib!=l.OK)ta.lastRequestErrorReason=ib;if(gb&&gb.json){if(gb.json.t)lb.t=gb.json.t;if(gb.json.reason)lb.reason=gb.json.reason;if(gb.json.seq)lb.seq=gb.json.seq;}pa.log('exit_'+kb,lb);i.inform(l.ON_EXIT_STATE,lb);var mb=this['_exit_'+kb];if(mb)ib=mb.apply(this,jb)||ib;if(ib!=l.OK){cb();wa[kb]=(wa[kb]||0)+1;}var nb=sa[this.nextState||kb][ib]||sa._all[ib],ob=nb&&nb.replace(/!*$/,'');if(!ob){pa.error('terminal_transition',lb);this._shutdownHint=l.HINT_INVALID_STATE;nb='shutdown!';this._logFantail('entering shutdown state',l.FANTAIL_ERROR);}this._lastState=kb;this._lastStatus=ib;this.enterState(nb);},_processTransportData:function(fb,gb){this._processTransportData0(fb,gb,gb.json);},_processTransportData0:function(fb,gb,hb){var ib=hb.t;if('s' in hb){hb.seq=hb.s;delete hb.s;}if(hb.u&&ta.user&&hb.u!=ta.user){pa.warn('misguided_msg',{user:ta.user,target:hb.u});this._reportProxyMisguidedMsg(hb.u,ta.user);return;}var jb=ta.seq;if('seq' in hb){ta.seq=hb.seq;ba.doSync();}switch(ib){case 'continue':if(ta.inStreaming&&this.heartbeats.length<1){ta.streamingCapable=false;pa.log('switch_to_longpoll');ma(this._probeTest,ta.PROBE_DELAY);}cb(true);if(!ta.inStreaming||ta.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:l.OK,stateId:fb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+hb.reason,l.FANTAIL_INFO);this.exitState({status:'refresh_'+(hb.reason||0),stateId:fb},gb);break;case 'backoff':this._logFantail('server told client to back off',l.FANTAIL_WARN);cb();this.backoff=true;break;case 'lb':var kb=hb.lb_info;if(kb){ta.sticky_token=kb.sticky;if('pool' in kb)ta.sticky_pool=kb.pool;if('vip' in kb)ta.host=kb.vip;db();}else pa.error('bad lb info');break;case 'test_streaming':ma(this._probeTest,500);break;case 'fullReload':aa.clear();pa.log('invalid_history');this.sessionRegistered=true;this.informCurrentSession();i.inform(l.ON_INVALID_HISTORY);cb(true);this._logFantail('full reload incurred',l.FANTAIL_INFO);var lb=l.ERROR_MISSING;if(ta.fullReloadAsSuccess)lb=l.OK;this.exitState({status:lb,stateId:fb},gb);if('ms' in hb)this._processMessages(hb,jb);break;case 'msg':cb(true);this._processMessages(hb,jb);break;case 'heartbeat':if(ta.inStreaming){var mb=Date.now();if(this.heartbeats.length>0){var nb=mb-this.heartbeats[this.heartbeats.length-1];pa.log('heartbeat_interval',{client_id:ta.sessionID,interval:nb});}this.heartbeats.push(mb);}break;case 'batched':var ob=hb.batches,pb;for(pb=0;pb<ob.length;pb++)this._processTransportData0(fb,gb,ob[pb]);break;default:this._logFantail('got an unknown protocol message: '+ib,l.FANTAIL_ERROR);pa.error('unknown_msg_type',{type:ib});break;}},_processMessages:function(fb,gb){var hb,ib,jb,kb;if('tr' in fb)ta.trace_id=fb.tr;ib=fb.ms;jb=ta.seq-ib.length;for(hb=0;hb<ib.length;hb++,jb++){ta.estimatedReceived++;if(jb>=gb){kb=ib[hb];if(kb.type){var lb=l.getArbiterType(kb.type);if(kb.type==='messaging'){var mb={type:'messaging',event:kb.event};if(kb.message){mb.inbox_unread=kb.unread_counts&&kb.unread_counts.inbox;mb.tid=kb.message.tid;mb.mid=kb.message.mid;this._logFantail('got message with id: '+kb.message.mid,l.FANTAIL_INFO);}}else if(kb.type==='pages_messaging'){if(kb.unread_counts&&kb.unread_counts.inbox)i.inform(l.getArbiterType('pages_inbox_count_update'),{page_id:kb[y.VIEWER_FBID],inbox_unread:kb.unread_counts.inbox});}else if(kb.type==='skywalker'){lb=l.SKYWALKER;}else if(kb.type==='qprimer'){kb.first=!ta.ready;if(kb.first){ta.ready=true;ta.timeUntilReady=Date.now()-ta.created;ta.queueMade=kb.made;}lb=l.CHANNEL_ESTABLISHED;}else if(kb.type==='delta')ta.sequenceId=kb.iseq;i.inform(lb,{obj:kb});}}else pa.warn('seq_regression',{seq:jb,last_seq:gb,messages:ib.length});}},_enter_init:function(){if(wa.init>=na.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:l.ERROR_MAX,stateId:va}),0);this._initTimer=ma(this.exitState.bind(this,{status:l.ERROR,stateId:va},'timeout'),ta.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(fb){this._logFantail('entered reconnect with reason: '+fb,l.FANTAIL_INFO);var gb=va;if(!ca.hasUserCookie()){this._logFantail('user has no cookie???',l.FANTAIL_WARN);pa.warn('no_user_cookie');setTimeout(function(){na._shutdownHint=l.HINT_AUTH;na.exitState({status:l.ERROR_SHUTDOWN,stateId:gb});},0);return;}var hb={reason:fb,fb_dtsg:r.getToken()};if(v.token)hb.fb_isb=v.token;if(qa)qa(hb);var ib=new t('GET','/ajax/presence/reconnect.php',hb);ib.onSuccess=(function(){na.configure(ib.json);aa.store();this.exitState({status:l.OK,stateId:gb});}).bind(this);ib.onError=(function(){var jb=ib.json&&ib.json.error;this._logFantail('reconnect error: '+ib.errorType,l.FANTAIL_ERROR);if(ib.errorType==h.TRANSPORT_ERROR||ib.errorType==h.PROXY_ERROR||ib.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=l.HINT_CONN;if(jb&&jb==1356007){this._shutdownHint=l.HINT_MAINT;}else if(jb==1357001||jb==1357004||jb==1348009){this._shutdownHint=l.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?l.ERROR_SHUTDOWN:l.ERROR,stateId:gb},ib);}).bind(this);ib.send();},_enter_shutdown:function(){i.inform(l.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!ta.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in ta&&ta.shutdown_recovery_interval_seconds>0){var fb=ta.shutdown_recovery_interval_seconds*1000;ma((function(){i.inform(l.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),fb);}},_exit_init:function(fb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(fb==l.ERROR_MAX)this._sendIframeError(l.reason_IFrameLoadGiveUp);},_exit_pull:function(fb,gb){var hb=fb==l.OK;ua.reportPullReturned(hb,this);if(hb){this.lastPullTime=Date.now();}else{var ib='exit status: '+fb;if(gb&&gb.errorType)ib+=' ajax request error: '+gb.errorType;this._logFantail('pull failed with status: '+ib,l.FANTAIL_ERROR);}},_exit_ping:function(fb){if(fb==l.OK){var gb=Date.now()-(this.lastPullTime||s.start);if(gb>ta.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',l.FANTAIL_ERROR);return l.ERROR_STALE;}}else this._logFantail('ping failed with status: '+fb,l.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(fb,gb){this._logFantail('misguided message to '+gb+' meant for '+fb,l.FANTAIL_ERROR);var hb=Date.now();if(hb-this.lastReportOnMisguidedMsgTime<=ta.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=hb;var ib={received_uid:fb,expected_uid:gb};if(ta.sticky_token)ib.sticky_token=ta.sticky_token;var jb=new ga('/err_misguided_msg').setDomain(ta.host+'.'+ta.domain).setPort(ta.port).setSecure(new ga(window.location.href).isSecure()).setQueryData(ib),kb=new h('GET',jb);if(h.supportsCORS())kb.xhr.withCredentials=true;kb.onSuccess=function(lb){};kb.onError=function(lb){};kb.onJSON=function(lb,mb){};kb.send();},_probeTest:function(){ta.streamingCapable=false;var fb=[],gb={mode:'stream',format:'json'};if(ta.sticky_token)gb.sticky_token=ta.sticky_token;var hb=new ga('/probe').setDomain(ta.host+'.'+ta.domain).setPort(ta.port).setSecure(new ga(window.location.href).isSecure()).setQueryData(gb),ib=new h('GET',hb);ib.onJSON=function(jb,kb){if(jb&&jb.json&&jb.json.t==='heartbeat'){fb.push(Date.now());if(fb.length>=2){var lb=fb[1]-fb[0];if(lb>=ta.PROBE_HEARTBEATS_INTERVAL_LOW&&lb<=ta.PROBE_HEARTBEATS_INTERVAL_HIGH){ta.streamingCapable=true;pa.log('switch_to_streaming');}pa.log('probe_ok',{time:lb});}}};ib.onSuccess=function(jb){if(fb.length!=2){ta.streamingCapable=false;pa.error('probe_error',{error:'beats.length = '+fb.length});}};ib.onError=function(jb){ta.streamingCapable=false;pa.error('probe_error',jb);};pa.log('probe_request');ib.send();},_logFantail:function(fb,gb){var hb=ta.fantail_queue_capacity||ta.FANTAIL_QUEUE_CAPACITY;if(!ta.fantail_enabled||ta.fantail_logs.length>hb)return;var ib='fantail queue size exceeded',jb=l.FANTAIL_WARN;if(ta.fantail_logs.length<hb){ib=fb;jb=gb;}var kb=ta.fantail_logs.length,lb={};lb['time'+kb]=Date.now();lb['log'+kb]=ib;lb['severity'+kb]=jb;ta.fantail_logs.push(lb);}};f.exports=na;function eb(){if(m.channelConfig){na.configure(m.channelConfig);if(/shutdown/.test(m.state))na._shutdownHint=l[m.reason];na.init(m.state,m.reason);}}if(p.get('early_channel',false)){eb();}else ea.onAfterLoad(eb);},6);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},null);
__d('TypingDetector',['ArbiterMixin','Event','Input','Run','SubscriptionsHandler','TypingStates','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(q,r){this._input=q;this._ignoreKeys={};this._getValueFn=r;}Object.assign(p.prototype,h,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=o;this.reset();this._subscriptions=new l();this._subscriptions.addSubscriptions(i.listen(this._input,'keyup',this._update.bind(this)),k.onUnload(this._onunload.bind(this)));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(q){this._ignoreKeys=n(q);},destroy:function(){this._subscriptions.release();},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var q=i.getKeyCode(event),r=this._currentState;if(!this._ignoreKeys[q]){var s=this._getValueFn?this._getValueFn():j.getValue(this._input);if(s.trim().length===0){if(r==m.TYPING)this._transition(m.INACTIVE);}else if(r==m.TYPING){this._recordKeystroke();}else if(r==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}}},_transition:function(q){this.reset();this._currentState=q;this.inform('change',q);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var q=this._lastKeystrokeTime+this._timeout,r=Date.now();if(r>q){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),q-r+10);}}});f.exports=p;},null);
__d('TypingDetectorController',['AsyncRequest','AvailableList','AvailableListConstants','ChannelConnection','ChatVisibility','Keys','MercuryServerRequestsConfig','TypingDetector','TypingStates','emptyFunction','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();function t(u,v,w,x,y,z){'use strict';this.userID=u;this.input=v;this.source=w;this.threadID=y;this.remoteState=p.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new o(v,z);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}t.prototype.setUserAndThread=function(u,v){'use strict';if(this.userID!==u||this.threadID!==v){this.resetState();this.userID=u;this.threadID=v;}};t.prototype.setIgnoreEnter=function(u){'use strict';var v=u?[m.RETURN]:[];this._typingDetector.setIgnoreKeys(v);};t.prototype.resetState=function(){'use strict';this._notifyState(p.INACTIVE);this.remoteState=p.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};t.prototype.destroy=function(){'use strict';this.resetState();this._typingDetector.destroy();};t.prototype._stateChange=function(u,v){'use strict';if(v!=p.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(s(this._notifyState,this,v),this.notifyDelay);}else this._notifyState(v,true);};t.prototype._notifyState=function(u,v){'use strict';if(!this.userID&&!this.threadID||!l.isOnline()||u===this.remoteState||k.disconnected())return;this._sendRequest(u,this.userID,v);};t.prototype._sendRequest=function(u,v,w){'use strict';this.remoteState=u;var x={typ:u,to:v,source:this.source,thread:this.threadID},y=new h().setHandler(this._onTypResponse.bind(this,v)).setErrorHandler(q).setData(x).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous_DEPRECATED',!w);if(n.msgrRegion)y.setRequestHeader('X-MSGR-Region',n.msgrRegion);y.send();};t.prototype._onTypResponse=function(u,v){'use strict';var w=v.getPayload()||{};if(w.offline)i.set(u,j.OFFLINE,'typing_response');};Object.assign(t.prototype,{notifyDelay:1000});f.exports=t;},null);
__d('SplitImage.react',['React','Image.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.createClass({displayName:'SplitImage',render:function(){var m=this.props.size;return (h.createElement('div',babelHelpers._extends({},this.props,{className:k(this.props.className,"_55lt"),style:babelHelpers._extends({},this.props.style||{},{width:m,height:m})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var m=this.props.srcs,n=Array.isArray(m);if(n){m=m.filter(function(o){return o!==null;});if(!m.length)return null;}if(!n||m.length==1)return this.renderOne(n?m[0]:m);return m.length==2?this.renderTwo(m):this.renderThree(m);},renderOne:function(m){return (h.createElement(i,{src:m,width:this.props.size,height:this.props.size,alt:''}));},renderTwo:function(m){var n=this.props.size,o=Math.floor(n/2),p=-Math.floor(o/2),q="_55lu"+(this.props.border?' '+"_57xo":'');return (h.createElement('div',null,h.createElement('div',{className:"_55lu",style:{width:o}},h.createElement(i,{src:m[0],width:n,height:n,style:{marginLeft:p},alt:''})),h.createElement('div',{className:q,style:{width:o}},h.createElement(i,{src:m[1],width:n,height:n,style:{marginLeft:p},alt:''}))));},renderThree:function(m){var n=this.props.size,o=Math.floor(n/3*2),p=-Math.floor((n-o)/2),q=Math.floor(n/2),r=n-o,s=-Math.floor((q-r)/2),t="_55lu"+(this.props.border?' '+"_57pl":''),u="_55lu"+(this.props.border?' '+"_57pm":'');return (h.createElement('div',null,h.createElement('div',{className:t,style:{width:o}},h.createElement(i,{src:m[0],width:n,height:n,style:{marginLeft:p},alt:''})),h.createElement('div',{className:u,style:{width:r,height:q}},h.createElement(i,{src:m[1],width:q,height:q,style:{marginLeft:s},alt:''})),h.createElement('div',{className:"_55lu",style:{width:r,height:q}},h.createElement(i,{src:m[2],width:q,height:q,style:{marginLeft:s},alt:''}))));}});f.exports=l;},null);
__d('MercuryMessageDeliveryState',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1};f.exports=h;},null);
__d('MercuryMessageInfo',['MercuryActionStatus','MercuryMessageDeliveryState','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={isOutbound:function(l){return l.author===j.getID();},isInbound:function(l){return !k.isOutbound(l);},isSending:function(l){return (l.status===h.UNSENT||l.status===h.UNCONFIRMED||l.status===h.UNABLE_TO_CONFIRM||l.status===h.RESENDING);},isSent:function(l){return (l.status===undefined||l.status===h.SUCCESS);},hasError:function(l){return (l.status===h.FAILED_UNKNOWN_REASON||l.status===h.UNABLE_TO_CONFIRM||l.status===h.ERROR);},getDeliveryState:function(l,m){if(this.hasError(l))return i.ERROR;if(this.isSending(l))return i.SENDING;if(this.isSent(l)){if(l.timestamp<=m)return i.DELIVERED;return i.SENT;}return i.UNKNOWN;}};f.exports=k;},null);
__d('MercuryErrorInfo',['MercuryErrorType','MercuryMessageInfo','fbt'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={getMessage:function(l){var m='';if(k.isConnectionError(l)){m=j._("This message didn't send.");if(k.isTransient(l))m=j._("{message} Check your internet connection and click to try again.",[j.param('message',m)]);}else{if(l&&l.description){m=l.description;}else m=j._("This message failed to send.");if(k.isTransient(l))m=j._("{message} Click to send again.",[j.param('message',m)]);}return m;},isConnectionError:function(l){if(l&&l.type==h.TRANSPORT)return l.code===1001||l.code===1004||l.code===1006;return false;},isTransient:function(l){return l&&l.is_transient;},isPermanent:function(l){return l?!this.isTransient(l):false;},hasErrorStatus:function(l){return i.hasError(l);}};f.exports=k;},null);
__d('MercuryMessageError.react',['CurrentUser','ImmutableObject','MercuryErrorInfo','MercuryMessageActions','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:o.string,message:o.instanceOf(i).isRequired},getDefaultProps:function(){return {authorFBID:h.getID()};},render:function(){var q=this.props.message,r=q.error_data;return (l.createElement('div',babelHelpers._extends({},this.props,{className:n(this.props.className,this._getClassNameFromStatus(q)),tabIndex:j.isTransient(r)?0:null,onClick:j.isTransient(r)?this.messageResend:null}),l.createElement('div',{className:"_2fs1"}),l.createElement('span',{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(q)}})));},messageResend:function(){k.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(q){if(j.hasErrorStatus(q)){return "_2fs2"+(' '+"_2fs3")+(j.isTransient(q.error_data)?' '+"_2fs4":'')+(j.isPermanent(q.error_data)?' '+"_2fs5":'');}else return "_2fs6 _2fs2";},_getTextFromStatus:function(q){var r='',s=q.error_data;if(j.hasErrorStatus(q))r=j.getMessage(s);if(typeof r==='object'&&r.__html)r=r.__html;return r;}});f.exports=p;},null);
__d('PhotoStoreCore',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(i){if(!this._photoCache[i])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[i];},hasBeenCreated:function(i){return !!this._photoCache[i];},clearSetCache:function(i){delete this._photoCache[i];delete this._postCreateCallbacks[i];},getByIndex:function(i,j,k){this.getPhotoCache(i).getItemAtIndex(j,k);},getByIndexImmediate:function(i,j){if(this._photoCache[i])return this._photoCache[i].getItemAtIndexImmediate(j);return undefined;},getItemsInAvailableRange:function(i){var j=this.getAvailableRange(i),k=[];for(var l=j.offset;l<j.length;l++)k.push(this.getByIndexImmediate(i,l));return k;},getItemsAfterIndex:function(i,j,k,l){var m=this.getCursorByIndexImmediate(i,j);this.fetchForward(i,m,k,l);},getAllByIDImmediate:function(i){var j=Object.keys(this._photoCache);return j.map((function(k){return this.getByIndexImmediate(k,this.getIndexForID(k,i));}).bind(this)).filter(function(k){return !!k;});},getIndexForID:function(i,j){if(this._photoCache[i])return this._photoCache[i].getIndexForID(j);return undefined;},getEndIndex:function(i){var j=this.getAvailableRange(i);return j.offset+j.length-1;},getCursorByIndexImmediate:function(i,j){var k=this.getByIndexImmediate(i,j);if(k)return this._photoCache[i].getCursorForID(k.id);return undefined;},hasNextPage:function(i){var j=this.getCursorByIndexImmediate(i,this.getEndIndex(i));return this.getPhotoCache(i).hasNextPage(j);},getAvailableRange:function(i){return this.getPhotoCache(i).getAvailableRange();},hasLooped:function(i){return this.getPhotoCache(i).hasLooped();},fetchForward:function(i,j,k,l){this.getPhotoCache(i).getItemsAfterCursor(j,k,l);},fetchBackward:function(i,j,k,l){this.getPhotoCache(i).getItemsBeforeCursor(j,k,l);},executePostCreate:function(i,j){if(this._photoCache[i]){j&&j();}else this._postCreateCallbacks[i]=j;},runPostCreateCallback:function(i){var j=this._postCreateCallbacks[i];if(j){j();delete this._postCreateCallbacks[i];}},setPreFetchCallback:function(i,j){this.getPhotoCache(i).setPreFetchCallback(j);},updateData:function(i){var j=i.set_id;if(!this._photoCache[j]){this._photoCache[j]=new i.cache_class(i);this.runPostCreateCallback(j);}else if(i.query_metadata.action==h.actions.UPDATE){this._photoCache[j].updateData(i);}else this._photoCache[j].addData(i);},updateFeedbackData:function(i){var j=Object.keys(i);j.forEach(function(k){return h.getAllByIDImmediate(k).forEach(function(l){l.feedback=i[k].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach((function(i){return this.clearSetCache(i);}).bind(this));}};f.exports=h;},null);
__d('MessengerHotLikePreviewEvents',['mixInEventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={START:'start',STOP:'stop',POP:'pop',REMOVE:'remove',FINISH_ANIMATION:'finish_animation'};h(i,{start:true,stop:true,pop:true,remove:'remove',finish_animation:'finish_animation'});f.exports=i;},null);
__d("XStickerAssetController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/asset\/",{sticker_id:{type:"Int",required:true},image_type:{type:"Enum",defaultValue:"BestEffortImage",enumType:1}});},null);
__d('MessengerHotLikeUtils',['StickerAssetType','StickerConstants','XStickerAssetController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={SizeTimes:{small:1000,medium:2000,large:3000},getStickerIDForTime:function(l){var m=null;switch(true){case l<this.SizeTimes.small:m=i.HOT_LIKE_SMALL_STICKER_ID;break;case l<this.SizeTimes.medium:m=i.HOT_LIKE_MEDIUM_STICKER_ID;break;case l<this.SizeTimes.large:m=i.HOT_LIKE_LARGE_STICKER_ID;break;}return m;},getGrowCoefficientForSince:function(l){return Math.min(1,(Date.now()-l)/this.SizeTimes.large);},getMetadataForHotLike:function(l){var m;switch(l){case i.HOT_LIKE_LARGE_STICKER_ID:m=120;break;case i.HOT_LIKE_MEDIUM_STICKER_ID:m=84;break;case i.HOT_LIKE_SMALL_STICKER_ID:m=35;break;}return m?{height:m,width:m}:undefined;},getPreviewURI:function(){return j.getURIBuilder().setInt('sticker_id',i.HOT_LIKE_LARGE_STICKER_ID).setEnum('image_type',h.IMAGE).getURI().toString();},getURIWithID:function(l){return j.getURIBuilder().setInt('sticker_id',l).setEnum('image_type',h.IMAGE).getURI().toString();}};f.exports=k;},null);
__d('MessengerContextBannerBootloader',['BootloadedComponent.react','CurrentUser','DOM','JSResource','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(q,r,s,t,u){var v=j.create('div');o(q,r,function(w){m.render(w,v,s(v));},t,u);}function o(q,r,s,t,u,v){v=babelHelpers._extends({left:0,position:'absolute',right:0,top:0},v);p({otherUserFBIDs:t&&[t],threadID:q,style:v},r,s,u);}function p(q,r,s,t){s(l.createElement(h,babelHelpers._extends({bootloadPlaceholder:l.createElement('div',{style:{height:80}}),bootloadLoader:k('MessengerContextBannerContainer.react'),location:r,onResize:t,viewer:i.getID()},q)));}f.exports={bootload:n,getBootloadedComponent:o};},null);
__d('MercuryTypingReceiver',['Arbiter','ChannelConstants','FBID','MercuryActionType','MercuryIDs','MercuryPayloadSource','MercuryDispatcher','MercurySingletonMixin','MercuryViewer','TypingStates','isEmpty','mixInEventEmitter','setTimeoutAcrossTransitions','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryThreadIDMap').get(),v=30000;function w(x){'use strict';this.$MercuryTypingReceiver1=null;this.$MercuryTypingReceiver2={};this.$MercuryTypingReceiver3=n.getForFBID(x);this.$MercuryTypingReceiver3.subscribe('update-typing-state',(function(z,aa){var ba=aa.payload_source;if(ba!=m.CLIENT_CHANNEL_MESSAGE)return;var ca=aa.actions;if(!ca||!ca.length)return;var da=k.USER_GENERATED_MESSAGE;ca.forEach((function(ea){if(ea.action_type==da&&ea.author!=p.getID())this.$MercuryTypingReceiver4(ea.thread_id,ea.author);}).bind(this));}).bind(this));var y;if(j.isUser(x)){y=[i.getArbiterType('typ'),i.getArbiterType('ttyp')];}else y=[i.getArbiterType('page_typing')];h.subscribe(y,(function(z,aa){var ba=aa.obj,ca=this.$MercuryTypingReceiver5(ba);if(ca){var da=l.getParticipantIDFromUserID(ba.from);if(ba.st==q.TYPING){this.$MercuryTypingReceiver2[ca]=this.$MercuryTypingReceiver2[ca]||{};var ea=this.$MercuryTypingReceiver2[ca][da];this.$MercuryTypingReceiver2[ca][da]=Date.now();if(!this.$MercuryTypingReceiver1)this.$MercuryTypingReceiver1=t((function(){this.$MercuryTypingReceiver6();}).bind(this),3000);!ea&&this.$MercuryTypingReceiver7(ca);}else if(ba.st==q.INACTIVE)this.$MercuryTypingReceiver4(ca,da);}}).bind(this));}w.prototype.$MercuryTypingReceiver8=function(x){'use strict';var y=this.$MercuryTypingReceiver2[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;};w.prototype.$MercuryTypingReceiver6=function(){'use strict';this.$MercuryTypingReceiver1=null;var x=Date.now(),y={},z=false;for(var aa in this.$MercuryTypingReceiver2){var ba=false;for(var ca in this.$MercuryTypingReceiver2[aa]||{})if(this.$MercuryTypingReceiver2[aa][ca]<x-v){delete this.$MercuryTypingReceiver2[aa][ca];ba=true;}else z=true;if(ba)y[aa]=this.$MercuryTypingReceiver8(aa);}if(!r(y))this.$MercuryTypingReceiver9(y);if(z)this.$MercuryTypingReceiver1=t((function(){this.$MercuryTypingReceiver6();}).bind(this),3000);};w.prototype.$MercuryTypingReceiver4=function(x,y){'use strict';if(x in this.$MercuryTypingReceiver2)if(y in this.$MercuryTypingReceiver2[x]){delete this.$MercuryTypingReceiver2[x][y];this.$MercuryTypingReceiver7(x);}};w.prototype.$MercuryTypingReceiver9=function(x){'use strict';this.releaseHeldEventType('state-changed');this.emitAndHold('state-changed',x);};w.prototype.$MercuryTypingReceiver7=function(x){'use strict';var y={};y[x]=this.$MercuryTypingReceiver8(x);this.$MercuryTypingReceiver9(y);};w.prototype.$MercuryTypingReceiver5=function(x){'use strict';if(x.thread_fbid)return u.getClientIDFromServerIDNow(x.thread_fbid.toString());if(x.type==='typ'||x.type==='page_typing')return l.getThreadIDFromUserID(x.from);return null;};s(w,{'state-changed':true});Object.assign(w,o);f.exports=w;},null);
__d('MercuryIndicatorController',['ArbiterMixin','DOM','MercuryActionType','MercuryDelayedRoger','MercuryIDs','MercuryMessageSourceTags','MercuryParticipants','MercuryViewer','WorkModeConfig','arrayContains','formatDate','removeFromArray','fbt','MercuryRoger','MercuryThreads','MercuryTypingReceiver'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryRoger').get(),v=c('MercuryThreads').get(),w=c('MercuryTypingReceiver').get(),x=[];function y(z){this._threadID=z;this._canonicalUser=l.getUserIDFromThreadID(z);x.push(this);}Object.assign(y.prototype,h,{destroy:function(){s(x,this);},setLastMessage:function(z){this._lastMsg=z;this._handleStateChange();},_informStateChanged:function(z){if(z.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&o.isViewer(this._lastMsg.author))z.self_authored=true;this._currentActivity=z.activity;this.inform('state-changed',z);},_notifySentFrom:function(){var z,aa,ba=this._lastMsg.source_tags||[];if(q(ba,m.MESSENGER)){if(!p.is_work_user){z=i.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},t._("Sent from Messenger"));}else z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Work Chat"));aa='sentFromMobile';}else if(q(ba,m.MOBILE)){z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Mobile"));aa='sentFromMobile';}else if(q(ba,m.EMAIL)){z=t._("Sent from email");aa='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:aa,text:z});},_notifySeenTimestamp:function(z){var aa=u.getSeenTimestamp(this._threadID,z[0])*.001,ba=Date.now()*.001,ca;if(aa<ba-518400){ca='M j';}else if(aa<ba-86400){ca='D g:ia';}else ca='g:ia';this._informStateChanged({activity:'seen-timestamp',text:t._("Seen {timestamp}",[t.param('timestamp',r(aa,ca))])});},_nameNormalizer:function(z){var aa;n.getMulti(z,function(ba){function ca(ea){if(ba[ea]!==undefined&&ba[ea].short_name){return ba[ea].short_name.toLowerCase();}else return ea;}var da=z.map(ca);aa=function(ea){var fa=ca(ea),ga=da.indexOf(fa)!==da.lastIndexOf(fa);return ga?ba[ea].name:ba[ea].short_name;};});return aa;},_seenByEveryone:function(z,aa,ba){var ca=ba?ba.participants.length:0,da=z.length;if(aa.author!=o.getID()&&(!ba||ba.participants.indexOf(aa.author)>-1))da++;return ca>2&&da>=ca-1;},_notifySeenBy:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,(function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea,fa=false,ga;if(da)ga=this._nameNormalizer(da.participants);if(!ga)ga=function(ka){return ca[ka].short_name;};if(this._seenByEveryone(z,aa,da)){ea=t._("Seen by everyone");}else if(z.length==1){ea=t._("Seen by {user}",[t.param('user',ca[z[0]].short_name)]);}else if(z.length==2){ea=t._("Seen by {user1}, {user2}",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name)]);}else if(z.length==3){ea=t._("Seen by {user1}, {user2}, {user3}",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('user3',ca[z[2]].short_name)]);}else if(z.length>3){var ha=Object.keys(ca).length-2,ia=t._({"*":"{num} more"},[t.param('num',ha,[0])]),ja=i.create('span',{className:'more'},ia);ea=t._("Seen by {user1}, {user2}, {=num more link}",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('=num more link',ja)]);fa=true;}this._informStateChanged({activity:'seen-by',text:ea,seenBy:z,tooltip:fa});}).bind(this));ba&&this._informStateChanged({activity:'none'});},_notifyTyping:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,(function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=da?da.participants.length:0,fa;if(da)fa=this._nameNormalizer(da.participants);if(!fa)fa=function(la){return ca[la].short_name;};var ga,ha=false;if(ea>2&&z.length>=ea-1){ga=t._("Everyone is typing...");}else if(z.length==1){ga=t._("{name} is typing...",[t.param('name',ca[z[0]].short_name)]);}else if(z.length==2){ga=t._("{user1} and {user2} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name)]);}else if(z.length==3){ga=t._("{user1}, {user2}, and {user3} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('user3',ca[z[2]].short_name)]);}else if(z.length>3){var ia=Object.keys(ca).length-2,ja=t._({"*":"{num} more"},[t.param('num',ia,[0])]),ka=i.create('a',{href:'#'},ja);ga=t._("{user1}, {user2}, and {=num more link} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('=num more link',ka)]);ha=true;}this._informStateChanged({activity:'typing',text:ga,typing:z,tooltip:ha});}).bind(this));ba&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var z=j.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==z){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=o.getID()){this._notifySentFrom();return;}var aa=k.getSeenBy(this._threadID,true);if(aa.length)if(this._canonicalUser){this._notifySeenTimestamp(aa);return;}else{this._notifySeenBy(aa);return;}this._informStateChanged({activity:'none'});}});w.addRetroactiveListener('state-changed',function(z){x.forEach(function(aa){var ba=z[aa._threadID];if(ba!==undefined){aa._typing=ba;aa._handleStateChange();}});});k.subscribe('state-changed',function(z,aa){x.forEach(function(ba){aa[ba._threadID]&&ba._handleStateChange();});});f.exports=y;},null);
__d('MercuryLastMessageIndicator.react',['DOM','MercuryIndicatorController','MercuryParticipants','React','ReactDOM','TooltipData','cx','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r=k.createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:q.bool,indicatorWillShow:q.func,indicatorDidShow:q.func,lastMessage:q.object,threadID:q.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:o,indicatorDidShow:o};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(s){if(s.threadID!=this.props.threadID){this._destroy();this._setup(s);}else if(s.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(s.lastMessage);},componentWillUpdate:function(s,t){if(this.isVisible(s,t))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.createElement('div',{className:this.getRootClass()},k.createElement('div',{className:"_510h"}),k.createElement('span',{className:"_510f",ref:'text'},'')));},getRootClass:function(){var s="_510g"+(this.state.data.self_authored?' '+"_510e":''),t=this.state.data.activity,u=null;if(String(t).startsWith('seen')){u='seen';}else if(t=='typing'){u=this.props.hideTyping?null:t;}else u=t;return p(s,u,this.props.className);},isVisible:function(s,t){s=s||this.props;t=t||this.state;return (t.data&&t.data.activity!='none'&&!(s.hideTyping&&t.data.activity=='typing'));},setText:function(){if(this.state.data.text)h.setContent(l.findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)j.getMulti(this.state.data.seenBy,(function(s){var t=h.create('div',null,this.state.data.seenBy.map(function(u){return h.create('div',null,s[u].name);}));m.set(h.find(l.findDOMNode(this),'span.more'),t,'above','center');}).bind(this));},_setup:function(s){this._controller=new i(s.threadID);this._subscription=this._controller.subscribe('state-changed',(function(t,u){return this.setState({data:u});}).bind(this));s.lastMessage&&this._controller.setLastMessage(s.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});f.exports=r;},null);
__d('WebMessengerDeleteThreadDialog',['React','SimpleXUIDialog','XUIDialogButton.react','XUIDialogCancelButton.react','fbt','MercuryThreadActions'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryThreadActions').get(),n={show:function(o){var p=l._("Delete This Entire Conversation?"),q=l._("Once you delete your copy of this conversation, it cannot be undone."),r=h.createElement('div',null,h.createElement(k,null),h.createElement(j,{action:'cancel',label:l._("Delete Conversation"),use:'confirm',onClick:function(){return m['delete'](o);}}));i.showEx(q,p,r);}};f.exports=n;},null);
__d('WebMessengerThreadPermalinks',['MercuryIDs','MessagingTag','URI','WebMessengerPermalinkConstants','WWWBase','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={getThreadURI:function(r,s,t){if(h.isCanonical(r)){o(r,s,t);}else p(r,s,t);}};function o(r,s,t){var u=new j(l.uri),v=h.tokenize(r).value;u.setPath(q(t)+'/'+v);s&&s(u.toString());}function p(r,s,t){m('MercuryThreadIDMap',function(u){var v=u.get();v.getServerIDFromClientID(r,function(w){var x=new j(l.uri);x.setPath(k.getURIPathForThreadID(w,q(t)));s&&s(x.toString());});});}function q(r){var s=k.BASE_PATH;if(r&&r!=i.INBOX)s+='/'+r;return s;}f.exports=n;},null);
__d('MercuryTypeaheadDataSource',['Banzai','BanzaiLogger','CurrentUser','DataSource','MercuryConfig','MercuryParticipantTypes','MercuryTypeaheadConstants','OrderedFriendsList','ShortProfiles','WorkModeConfig','debounce'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s,t,u=500,v=[],w={},x={},y={},z=false,aa=false;s=babelHelpers.inherits(ba,k);t=s&&s.prototype;function ba(ca){'use strict';ca=ca||{};ca.kanaNormalization=true;t.constructor.call(this,ca);this.logQuery=r(function(da){this.$MercuryTypeaheadDataSource1(da);},u,this,true);this.logResponse=r(function(da){this.$MercuryTypeaheadDataSource1(da);},u,this,true);}ba.prototype.dirty=function(){'use strict';this.$MercuryTypeaheadDataSource2=v;this.localCache=x;this.queryCache=w;this.queryIDs=y;return this;};ba.prototype.bootstrap=function(){'use strict';if(z||aa)return false;this.$MercuryTypeaheadDataSource1({event:'bootstrap_start'});aa=true;p.fetchAll().then((function(){this.updateBootstrapData();this.$MercuryTypeaheadDataSource1({event:'bootstrap_end'});aa=false;z=true;}).bind(this),(function(){this.$MercuryTypeaheadDataSource1({event:'bootstrap_failure'});}).bind(this));return true;};ba.prototype.updateBootstrapData=function(){'use strict';var ca=this.getCachedShortProfileIDs(),da=q.is_work_user?m.FB4C:m.FRIEND,ea=ca.map(function(fa){var ga=p.getNow(fa),ha=fa==j.getID()?da:ga.type,ia=[ga.additionalName,ga.alternateName].concat(ga.searchTokens||[]).join(' ');return {uid:fa,index:o.getActiveRank(fa),text:ga.name,tokens:ia,localized_text:ga.name,additional_text:ga.additionalName,photo:ga.thumbSrc,render_type:ha,type:n.USER_TYPE};});if(ea.length)this.addEntries(ea);};ba.prototype.query=function(ca,da,ea,fa){'use strict';var ga=da||ca.length===1;return t.query.call(this,ca,ga,ea,fa);};ba.prototype.getQueryData=function(ca,da){'use strict';return babelHelpers._extends({},t.getQueryData.call(this,ca,da));};ba.prototype.setEntry=function(ca,da){'use strict';this.$MercuryTypeaheadDataSource2[ca]=da;};ba.prototype.getEntry=function(ca){'use strict';return this.$MercuryTypeaheadDataSource2[ca]||null;};ba.prototype.getCachedShortProfileIDs=function(){'use strict';var ca=p.getCachedProfileIDs(),da=ca.filter(function(ea){var fa=p.getNow(ea);return (ea==j.getID()||fa.type===m.FRIEND||fa.type===m.FB4C||fa.type===m.PAGE&&l.LinkedAgents&&l.LinkedAgents.indexOf(ea.toString())>-1);});return da;};ba.prototype.isBootstrapped=function(){'use strict';return z;};ba.prototype.isBootstrapping=function(){'use strict';return aa;};ba.prototype.processEntries=function(ca,da){'use strict';ca=ca.map(function(ea){if(ea.index==null&&(ea.render_type===m.FRIEND||ea.render_type===m.FB4C))ea.index=o.getActiveRank(ea.uid);if(ea.render_type===m.PAGE&&l.LinkedAgents&&l.LinkedAgents.indexOf(ea.uid.toString())>-1)ea.index=1;return ea;});return t.processEntries.call(this,ca);};ba.prototype.mergeUids=function(ca,da,ea,fa){'use strict';var ga=da.sort((function(ha,ia){return this.getEntry(ha).index-this.getEntry(ia).index;}).bind(this));return t.mergeUids.call(this,ca,ga,ea,fa);};ba.prototype.$MercuryTypeaheadDataSource1=function(ca){'use strict';if(!h.isEnabled('mercury_typeahead_logging'))return;i.log('MercuryQueryResultsLoggerConfig',ca);};f.exports=ba;},null);
__d('PhotoStore',['Arbiter','PhotoStoreCore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();h.subscribe('update-photos',function(j,k){i.updateData(k);});f.exports=i;},null);
__d('MessagesViewer',['AsyncRequest','Bootloader','DOM','MessagesViewerSetID','PhotoStore','React','ReactDOM','Run','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={bootstrapWithElem:function(u){r.bootstrapWithConfig({fbid:u.getAttribute('data-fbid'),dimensions:u.getAttribute('data-dimensions'),src:u.getAttribute('href'),endpoint:u.getAttribute('data-endpoint'),disablePaging:u.getAttribute('data-disablepaging')},u);},bootstrapWithConfig:function(u,v){var w=u.setID;if(!w)w=k.MESSAGES;t(function(x,y){s(m.createElement(x,{actorid:u.actorid,dimensions:[u.dimensions],disablepaging:u.disablePaging,disableForward:u.disableForward,open:true,photoid:u.fbid,reverse:false,rootClassName:u.rootClassName,setid:w,snapToPhoto:u.snapToPhoto,thumbsrc:u.src}));if(!l.hasBeenCreated(w)&&u.endpoint){var z=new h(u.endpoint);if(v)z.setRelativeTo(v);z.send();}});},renderVideo:function(u){t(function(v,w){s(m.createElement(w,u));});},preload:function(){o.onAfterLoad(function(){return t(p);});}};function s(u){var v=q('messages_viewer');if(!v){v=j.create('div',{id:'messages_viewer'});document.body.appendChild(v);}u=n.render(u,v);u.subscribeOnce('close',function(){n.unmountComponentAtNode(v);});}function t(u){i.loadModules(["SpotlightMessagesViewer","MessagingVideoViewer.react"],u);}f.exports=r;},null);
__d('MercuryLogMessageRenderer',['BootloadedComponent.react','Bootloader','CSS','HovercardLink','JSResource','MercuryIDs','MercuryViewer','MessagesViewer','MercuryLogMessageType','MessagingGenericAdminTextType','MercuryParticipants','React','ReactDOM','Image.react','TextWithEntities.react','TooltipLink.react','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa={renderText:function(pa,qa){switch(pa.log_message_type){case p.SUBSCRIBE:da(pa,qa);break;case p.UNSUBSCRIBE:ia(pa,qa);break;case p.THREAD_NAME:ja(pa,qa);break;case p.THREAD_IMAGE:ka(pa,qa);break;case p.WALLPAPER:la(pa,qa);break;case p.GENERIC_ADMIN_TEXT:ma(pa,qa);break;default:i.loadModules(["MercurySpecialLogMessageRenderer"],function(ra){ra.renderText(pa,qa);});break;}},renderIcon:function(pa){return (s.createElement(u,{className:ba(pa),src:z('images/spacer.gif')}));},renderLegacy:function(pa,qa,ra,sa){ba(sa).split(' ').forEach(function(ta){return ta&&j.addClass(pa,ta);});this.renderText(sa,function(ta){t.render(s.createElement('span',null,ta),qa);});this.renderAttachmentLegacy(ra,sa);},renderAttachmentLegacy:function(pa,qa){if(qa.log_message_type==p.THREAD_IMAGE){var ra=qa.log_message_data.image;if(ra&&ra.preview_url){t.render(s.createElement(u,{className:"_z6a",onClick:function(){return ca(ra);},src:ra.preview_url}),pa);j.show(pa);}}}};f.exports=aa;function ba(pa){var qa=pa.log_message_type,ra=pa.log_message_data;return "_5wzu"+(qa==p.SUBSCRIBE?' '+"_5wzj":'')+(qa==p.UNSUBSCRIBE?' '+"_5wzk":'')+(qa==p.THREAD_NAME?' '+"_5wzl":'')+(qa==p.THREAD_IMAGE?' '+"_5wzm":'')+(qa==p.VIDEO_CALL&&ra.answered?' '+"_5wzn":'')+(qa==p.VIDEO_CALL&&!ra.answered?' '+"_5wzo":'')+(qa==p.PHONE_CALL&&ra.answered?' '+"_5wzp":'')+(qa==p.PHONE_CALL&&!ra.answered?' '+"_5wzq":'')+(qa==p.SERVER_ERROR?' '+"_5wzr":'');}function ca(pa){o.bootstrapWithConfig({src:pa.preview_url,endpoint:pa.url,fbid:pa.metadata.fbid,dimensions:pa.metadata.dimensions,disablePaging:true},null);}function da(pa,qa){var ra=oa(pa.log_message_data.added_participants);switch(ra.length){case 1:ea(pa,qa,ra);break;case 2:fa(pa,qa,ra);break;case 3:ga(pa,qa,ra);break;default:ha(pa,qa,ra);break;}}function ea(pa,qa,ra){var sa=[pa.author,ra[0]];r.getMulti(sa,function(ta){if(pa.author==n.getID()){qa(y._("You added {subscriber1}.",[y.param('subscriber1',na(ta[ra[0]]))]));}else if(ra[0]==n.getID()){qa(y._("{actor} added you.",[y.param('actor',na(ta[pa.author]))]));}else qa(y._("{actor} added {subscriber1}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber1',na(ta[ra[0]]))]));});}function fa(pa,qa,ra){var sa=[pa.author].concat(ra);r.getMulti(sa,function(ta){if(pa.author==n.getID()){qa(y._("You added {subscriber1} and {subscriber2}.",[y.param('subscriber1',na(ta[ra[0]])),y.param('subscriber2',na(ta[ra[1]]))]));}else if(ra[0]==n.getID()){qa(y._("{actor} added you and {subscriber2}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber2',na(ta[ra[1]]))]));}else qa(y._("{actor} added {subscriber1} and {subscriber2}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber1',na(ta[ra[0]])),y.param('subscriber2',na(ta[ra[1]]))]));});}function ga(pa,qa,ra){var sa=[pa.author].concat(ra);r.getMulti(sa,function(ta){if(pa.author==n.getID()){qa(y._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[y.param('subscriber1',na(ta[ra[0]])),y.param('subscriber2',na(ta[ra[1]])),y.param('subscriber3',na(ta[ra[2]]))]));}else if(ra[0]==n.getID()){qa(y._("{actor} added you, {subscriber2} and {subscriber3}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber2',na(ta[ra[1]])),y.param('subscriber3',na(ta[ra[2]]))]));}else qa(y._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber1',na(ta[ra[0]])),y.param('subscriber2',na(ta[ra[1]])),y.param('subscriber3',na(ta[ra[2]]))]));});}function ha(pa,qa,ra){var sa=[pa.author].concat(ra);r.getMulti(sa,function(ta){function ua(wa){var xa=s.createElement('div',null,wa.map(function(ya){return s.createElement('div',null,ya.name);}));return (s.createElement(w,{alignH:'center',position:'above',tooltip:xa},y._({"*":"{num} more"},[y.param('num',wa.length,[0])])));}var va=ra.map(function(wa){return ta[wa];});if(pa.author==n.getID()){qa(y._("You added {subscriber1}, {subscriber2} and {more_people}.",[y.param('subscriber1',na(va[0])),y.param('subscriber2',na(va[1])),y.param('more_people',ua(va.slice(2)))]));}else if(ra[0]==n.getID()){qa(y._("{actor} added you, {subscriber2} and {more_people}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber2',na(va[1])),y.param('more_people',ua(va.slice(2)))]));}else qa(y._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[y.param('actor',na(ta[pa.author])),y.param('subscriber1',na(va[0])),y.param('subscriber2',na(va[1])),y.param('more_people',ua(va.slice(2)))]));});}function ia(pa,qa){var ra=[pa.author],sa=pa.log_message_data.removed_participants,ta;if(sa.length===1){ta=sa[0];ra.push(ta);}r.getMulti(ra,function(ua){var va=ua[pa.author],wa=ua[ta];if(pa.author==n.getID()){if(!ta||ta==pa.author){qa(y._("You left the conversation."));}else qa(y._("You removed {name} from the conversation.",[y.param('name',na(wa))]));}else if(!ta||ta==pa.author){qa(y._("{actor} left the conversation.",[y.param('actor',na(va))]));}else if(ta==n.getID()){qa(y._("{actor} removed you from the conversation.",[y.param('actor',na(va))]));}else qa(y._("{actor} removed {name} from the conversation.",[y.param('actor',na(va)),y.param('name',na(wa))]));});}function ja(pa,qa){var ra=pa.log_message_data.name;if(pa.author==n.getID()){if(ra){qa(y._("You named the conversation: {name}.",[y.param('name',s.createElement('span',{className:"_5wzs"},s.createElement(v,{renderEmoticons:true,renderEmoji:true,text:ra})))]));}else qa(y._("You removed the conversation name."));}else r.get(pa.author,function(sa){var ta=na(sa);if(ra){qa(y._("{actor} named the conversation: {name}.",[y.param('actor',ta),y.param('name',s.createElement('span',{className:"_5wzs"},ra))]));}else qa(y._("{actor} removed the conversation name.",[y.param('actor',ta)]));});}function ka(pa,qa){if(pa.author==n.getID()){if(pa.log_message_data.image){qa(y._("You changed the conversation picture."));}else qa(y._("You removed the conversation picture."));}else r.get(pa.author,function(ra){var sa=na(ra);if(pa.log_message_data.image){qa(y._("{actor} changed the conversation picture.",[y.param('actor',sa)]));}else qa(y._("{actor} removed the conversation picture.",[y.param('actor',sa)]));});}function la(pa,qa){if(pa.author==n.getID()){qa(y._("You changed the wallpaper."));}else r.get(pa.author,function(ra){var sa=na(ra);qa(y._("{actor} changed the wallpaper.",[y.param('actor',sa)]));});}function ma(pa,qa){var ra=pa.log_message_body,sa=pa.log_message_data;switch(sa.message_type){case q.TURN_ON_PUSH:if(ra&&ra.length>0)ra=y._("{admin-text-message} for Messenger on mobile.",[y.param('admin-text-message',ra.substring(0,ra.length-1))]);break;case q.JOURNEY_PROMPT_COLOR:ra=y._("You need to be on the latest version of Messenger on a mobile device to pick a color for this conversation.");break;case q.JOURNEY_PROMPT_NICKNAME:var ta=null,ua=m.getUserIDFromParticipantID(pa.author);if(pa.other_user_fbid&&ua!==pa.other_user_fbid){var va=m.getParticipantIDFromUserID(pa.other_user_fbid);ta=r.getOrFetch(va);}if(ta&&ta.short_name){ra=y._("You need to be on the latest version of Messenger on a mobile device to set a nickname for {admin-text-message} .",[y.param('admin-text-message',ta.short_name)]);}else ra=y._("You need to be on the latest version of Messenger on a mobile device to set a nickname for yourself.");break;case q.JOURNEY_PROMPT_LIKE:ra=y._("You need to be on the latest version of Messenger on a mobile device to pick an emoji for this conversation.");break;default:break;}qa(ra);}function na(pa,qa){var ra=pa.fbid,sa=k.constructEndpoint({id:ra});if(pa.href)return (s.createElement('a',{className:"_5wzt",href:pa.href,'data-hovercard':sa},qa?pa.short_name:pa.name));return pa.name;}function oa(pa){var qa=pa.indexOf(n.getID());if(qa>0){var ra=pa.filter(function(sa){return sa!==n.getID();});return [n.getID()].concat(ra);}return pa;}},null);
__d('MercuryThreadSearchUtils',['escapeRegex','TokenizeUtil'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={wordsInString:function(k){return (k||'').split(/\s+/).filter(function(l){return l.trim().length>0;});},anyMatchPredicate:function(k,l){for(var m=0;m<k.length;m++)if(l(k[m]))return true;return false;},allMatchPredicate:function(k,l){for(var m=0;m<k.length;m++)if(!l(k[m]))return false;return true;},queryWordMatchesAnyNameWord:function(k,l){var m=new RegExp('^'+h(k),'i');return this.anyMatchPredicate(l,function(n){var o=i.parse(n).flatValue;return m.test(o);});},queryMatchesName:function(k,l){var m=this.wordsInString(k),n=this.wordsInString(l);return this.allMatchPredicate(m,(function(o){return this.queryWordMatchesAnyNameWord(o,n);}).bind(this));}};f.exports=j;},null);
__d('MercuryMessageGroup',['MercuryActionType','MercuryAttachmentType','MercuryShareAttachmentRenderLocations','MercuryThreadlistConstants','enumerate'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m={calculateMessageGroups:function(p,q){var r=[],s=null,t={value:null},u=l(p),v;while(!(v=u.next()).done){var w=m.canAppendMessageToLastGroup(t.value,v.value,q);if(!w){s=[];r.push(s);}s.push(v.value);t=v;}return r;},canAppendMessageToLastGroup:function(p,q,r){var s=k.GROUPING_THRESHOLD;if(!p||n(p,r)||n(q,r)||p.author!=q.author||p.timestamp<q.timestamp-s||p.is_spoof_warning!==q.is_spoof_warning||p.page_admin_notes)return false;return true;}};function n(p,q){var r=p.has_attachment;if(r&&(q===j.MESSENGER||q===j.CHAT))r=o(p);return !!(p.action_type==h.LOG_MESSAGE||r||p.forward_count||p.html_body||p.body&&p.body.length>k.MAX_CHARS_BEFORE_BREAK);}function o(p){var q=p.attachments[0];return (!q||q.attach_type===i.STICKER||q.attach_type===i.ANIMATED_IMAGE);}f.exports=m;},null);
__d('P2PAbstractSendMoneyButton.react',['React','TooltipLink.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.PropTypes,m=h.createClass({displayName:'P2PAbstractSendMoneyButton',propTypes:{button:l.object,isActive:l.bool.isRequired,isDisabled:l.bool.isRequired,isMessenger:l.bool.isRequired,onClick:l.func.isRequired,onMouseOver:l.func,recipientName:l.string},_clickGuard:false,render:function(){return (h.createElement(i,{alignH:'center',className:(this.props.isActive?"_10gz":'')+(this.props.isDisabled?' '+"_10g-":'')+(!this.props.isMessenger?' '+"_5uqy":'')+(this.props.isMessenger?' '+"_3ggc":''),href:'#',onClick:this._handleClick,onMouseDown:this._prepareForClick,onMouseOver:this.props.onMouseOver,position:'above',role:'button',title:this._getLinkTitle(),tooltip:this._getDisabledTitle()},this.getButton()));},getButton:function(){if(this.props.button)return this.props.button;return h.createElement('i',{className:"_5s8l"});},_getLinkTitle:function(){if(this.props.isDisabled)return null;return k._("Send Money");},_getDisabledTitle:function(){if(!this.props.isDisabled)return null;return k._("{receiverName} isn't able to receive money right now.",[k.param('receiverName',this.props.recipientName)]);},_prepareForClick:function(){this._clickGuard=this.props.isActive;},_handleClick:function(n){n.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.props.onClick();}});f.exports=m;},null);
__d('P2PSendMoneyButton.react',['Bootloader','CurrentEnvironment','DeferredComponent.react','P2PAbstractSendMoneyButton.react','React','Run','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=i.messengerdotcom,q=l.createClass({displayName:'P2PSendMoneyButton',propTypes:{button:o.object,flyoutAlignment:o.string,isNewEmptyLocalThread:o.bool,isGroupChat:o.bool,onTrigger:o.func,participants:o.arrayOf(o.object),threadID:o.string,threadFBID:o.string},getDefaultProps:function(){return {participants:[]};},render:function(){return (l.createElement(j,babelHelpers._extends({deferredComponent:r,deferredPlaceholder:this._renderPlaceholder()},this.props)));},_renderPlaceholder:function(){return (l.createElement(k,{button:this.props.button,isActive:false,isDisabled:true,isMessenger:p,onClick:n,onMouseOver:s,recipientName:this._getRecipientName()}));},_getRecipientName:function(){var t=this.props.participants;if(!this.props.isGroupChat&&t&&t.length>0)return t[0].short_name;return null;}});function r(t){m.onAfterLoad(function(){h.loadModules(["P2PSendMoneyButtonImpl.react"],t);});}function s(){h.loadModules(["P2PSendMoneyButtonImpl.react"],n);}f.exports=q;},null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m,n;k=babelHelpers.inherits(o,i);l=k&&k.prototype;function o(){l.constructor.call(this);n={};m=j.register(this.onEventDispatched.bind(this));}o.prototype.onEventDispatched=function(p){var q=p.data,r=p.type;switch(r){case h.CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(q);this.emit('change');break;case h.CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(q);this.emit('change');break;}};o.prototype.getStateByThreadID=function(p){return n[p];};o.prototype.handleChatSendViewOpened=function(p){n[p.threadID]={amount:p.amount,groupSendRecipient:p.groupSendRecipient,groupSendReceiptDetails:p.groupSendReceiptDetails,groupThreadFBID:p.groupThreadFBID,memoText:p.memoText,platformData:p.platformData,referrer:p.referrer,paymentRequestID:p.paymentRequestID,sendMoneyDialogShown:true,useModal:p.useModal};};o.prototype.handleChatSendViewClosed=function(p){n[p.threadID]={amount:'',groupSendRecipient:null,groupSendReceiptDetails:null,groupThreadFBID:'',memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,useModal:false};};f.exports=new o();},null);
__d('StickersDispatcher',['Dispatcher','StickerConstants'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=Object.assign(new h(),{_handleUpdate:function(k,l){var m=babelHelpers._extends({payloadSource:k},l);this.dispatch(m);},handleUpdateFromViewActions:function(k){this._handleUpdate(i.PayloadSource.VIEW_ACTION,k);}});f.exports=j;},null);
__d('StickerActions',['BanzaiLogger','StickersDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j({ADD_PACK:null,CLICKED_STICKER_IN_THREAD:null,HIDE_TRAY:null,REMOVE_PACK:null,REPLACE_STICKER_STATE:null,RESET_NUM_NEW_PACKS:null,SELECT_PACK:null,SELECT_STORE_PACK:null,SHOW_TRAY:null,UPDATE_TRAY_DATA:null,TRAY_DATA_READY:null}),l={Types:k,addPack:function(m){i.dispatch({type:k.ADD_PACK,packID:m});},removePack:function(m){i.dispatch({type:k.REMOVE_PACK,packID:m});},selectPack:function(m,n){if(!n)h.log('StickersLoggerConfig',{event:'select_pack',packid:m});i.dispatch({type:k.SELECT_PACK,packID:m});},selectStorePack:function(m){i.dispatch({type:k.SELECT_STORE_PACK,packID:m});},resetNumNewPacks:function(){i.dispatch({type:k.RESET_NUM_NEW_PACKS});},handleStickerClick:function(m,n){i.dispatch({packID:m,threadID:n,type:l.Types.CLICKED_STICKER_IN_THREAD});},showStickerTray:function(m){i.dispatch({type:l.Types.SHOW_TRAY,threadID:m});},hideStickerTray:function(){i.dispatch({type:l.Types.HIDE_TRAY});},updateTrayData:function(){i.dispatch({type:l.Types.UPDATE_TRAY_DATA});},loadedTrayData:function(){i.dispatch({type:l.Types.TRAY_DATA_READY});}};f.exports=l;},null);
__d("XStickerPackImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});},null);
__d("XStickersAddPackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},is_promoted:{type:"Bool",defaultValue:false}});},null);
__d("XStickersRemovePackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/removepack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"}});},null);
__d("XStickerStateInitialDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/store\/",{});},null);
__d("XStickerQueryImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/query\/images\/",{query:{type:"String",required:true},sticker_interface:{type:"String"}});},null);
__d('StickerServerRequests',['AsyncRequest','Promise','XStickerPackImagesController','XStickersAddPackController','XStickersRemovePackController','XStickerStateInitialDataController','XStickerStatePackDataController','XStickerStateStoreDataController','XStickerQueryImagesController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={addPack:function(s,t,u){var v=k.getURIBuilder().setInt('pack_id',s).setBool('is_promoted',t).getURI();new h(v).setHandler(function(w){return u(w.payload);}).send();},removePack:function(s,t){var u=l.getURIBuilder().setInt('pack_id',s).getURI();new h(u).setHandler(function(v){return t(v.payload);}).send();},getStickersForPack:function(s,t){var u=j.getURIBuilder().setInt('pack_id',s).setInt('sticker_size',t).getURI();return new i(function(v,w){return (new h().setURI(u).setMethod('GET').setReadOnly(true).setHandler(function(x){return v(x.payload);}).send());});},getStickersForQuery:function(s,t,u){new h().setURI(p.getURIBuilder().setString('query',s).setString('sticker_interface',t).getURI()).setMethod('GET').setReadOnly(true).setHandler(function(v){return u(v);}).send();},fetchTrayData:function(s){return r(m.getURIBuilder().getURI(),s,true);},fetchStoreData:function(s){return r(o.getURIBuilder().getURI(),s);},fetchPackData:function(s,t){return r(n.getURIBuilder().setInt('pack_id',s).getURI(),t);}};function r(s,t,u){return new i(function(v,w){return (new h(s).setHandler(function(x){return v(x.getPayload());}).setAllowCrossPageTransition(u).send());}).then(t);}f.exports=q;},null);
__d('StickerImages',['StickerServerRequests'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={},j={},k={},l={getStickerTagsData:function(){return k;},requestStickersForPack:function(m,n,o){if(!m)return;if(!j[m]){j[m]=h.getStickersForPack(m,n);j[m].then((function(p){p.forEach((function(q){return this.cacheSticker(q);}).bind(this));}).bind(this));}j[m].then(function(p){return o(p);});},cacheSticker:function(m){i[m.id]=m;},getSticker:function(m){return i[m];}};f.exports=l;},null);
__d('StickerState',['ImmutableObject','StickerConfig','PresenceState','StickerActions','StickerConstants','StickerImages','StickerServerRequests'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o={},p,q,r,s=null,t=0,u={},v=[],w=[],x=[],y=null,z=null,aa=j.get();if(aa)y=aa.tray_pack_id;var ba=i.ShowStickerReplyNUX,ca={onTrayDataReady:function(ea){if(!q)q=n.fetchTrayData(function(fa){v=fa.packs.map(function(ga){return da(ga);});r=fa.mru;t=fa.num_new_packs;x=fa.tags;});q.then(function(){ea();k.loadedTrayData();});},onStoreDataReady:function(ea){if(!p)p=n.fetchStoreData(function(fa){w=fa.packs.map(function(ga){return da(ga);});});p.then(ea);},onPackDataReady:function(ea,fa){if(!o[ea])o[ea]=n.fetchPackData(ea,function(ga){da(ga);});o[ea].then(fa);},getPacksInTrayAllInterfaces:function(){return v;},getPacksInTray:function(){var ea=[],fa;for(var ga=0;ga<v.length;ga++)if(v[ga].id==l.EMOTICON_PACK_ID){fa=v[ga];}else if(v[ga].isMessengerCapable)ea.push(v[ga]);fa&&ea.push(fa);return ea;},getPacksInCommentsTray:function(){var ea=[],fa=[],ga;for(var ha=0;ha<v.length;ha++)if(v[ha].id==l.EMOTICON_PACK_ID){ga=v[ha];}else if(v[ha].isCommentsCapable){ea.push(v[ha]);}else fa.push(v[ha]);var ia=ea.concat(fa);if(ga)ia.push(ga);return ia;},getPacksInComposerTray:function(){return v.filter(function(ea){return ea.isComposerCapable;});},getPacksInFramesTray:function(){return v.filter(function(ea){return ea.isFramePack;});},getPackIDsInTray:function(){return v.map(function(ea){return ea.id;});},getPacksInStore:function(){return w.filter(function(ea){return ea.isMessengerCapable;});},getComposerPacksInStore:function(){return w.filter(function(ea){return ea.isComposerCapable;});},getPack:function(ea){return u[ea];},getNumNewPacks:function(){return t;},getFeaturedTags:function(){return x;},resetNumNewPacks:function(){t=0;},addMRUPack:function(){if(r){this._addPackToTray(r);r=null;}},addPack:function(ea){var fa=false;if(u[ea])fa=u[ea].isPromoted;n.addPack(ea,fa,(function(ga){this._addPackToTray(ga);}).bind(this));},removePack:function(ea){n.removePack(ea,function(fa){v=v.filter(function(ga){return ga.id!==fa;});u[fa]=h.set(u[fa],{isInTray:false});w=w.map(function(ga){return u[ga.id];});k.updateTrayData();});},setTrayPackID:function(ea){y=ea;j.doSync();},getTrayPackID:function(ea){if(ea&&ea.length>0&&!ea.some(function(fa){return fa.id===y;})){return ea[0].id;}else return y;},setStorePackID:function(ea){z=ea;},getStorePackID:function(){return z;},shouldShowStickerReplyNUX:function(){return ba;},clearShowStickerReplyNUX:function(){ba=false;},_addPackToTray:function(ea,fa){da(ea);u[ea.id]=h.set(u[ea.id],{isPurchased:!fa,isInTray:true});var ga=v.filter(function(ia){return ia.id===ea.id;}).length>0;if(!ga){var ha;if(!fa){ha=v.filter(function(ia){return ia.isMRU||ia.isSearch;}).length;}else ha=v.filter(function(ia){return ia.id!==l.EMOTICON_PACK_ID;}).length;v.splice(ha,0,u[ea.id]);}w=w.map(function(ia){return u[ia.id];});k.updateTrayData();},_addRecentlyUsedSticker:function(ea){for(var fa=0;fa<s.length;++fa)if(s[fa].id===ea.id){s.splice(fa,1);break;}s.unshift(ea);},getMRUStickerPack:function(ea){if(!s)s=ea;return s;},updateRecentlyUsed:function(ea){if(!s){this.addMRUPack();return;}this._addRecentlyUsedSticker(m.getSticker(ea));}};j.registerStateStorer(function(ea){ea.tray_pack_id=y;});function da(ea){var fa=ea.id;if(!u[fa]){return u[fa]=new h(ea);}else return u[fa]=h.set(u[fa],ea);}f.exports=ca;},null);
__d('AbstractDialogFitHeight',['CSS','DOM','Event','Style','SubscriptionsHandler','Vector','csx','cx','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=450,r=100,s=67,t=67;function u(v){'use strict';this.$AbstractDialogFitHeight1=v;}u.prototype.enable=function(){'use strict';this.$AbstractDialogFitHeight2=new l();this.$AbstractDialogFitHeight2.addSubscriptions(this.$AbstractDialogFitHeight1.subscribe('beforeshow',this.$AbstractDialogFitHeight3.bind(this)),j.listen(window,'resize',p(this.$AbstractDialogFitHeight3.bind(this))));this.$AbstractDialogFitHeight4=i.find(this.$AbstractDialogFitHeight1.getRoot(),"._4-i2");h.addClass(this.$AbstractDialogFitHeight4,"_5pfh");this.$AbstractDialogFitHeight5=r;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._4-i0").length)this.$AbstractDialogFitHeight5+=s;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._5a8u").length)this.$AbstractDialogFitHeight5+=t;};u.prototype.disable=function(){'use strict';this.$AbstractDialogFitHeight2.release();this.$AbstractDialogFitHeight2=null;h.removeClass(this.$AbstractDialogFitHeight4,"_5pfh");};u.prototype.$AbstractDialogFitHeight3=function(){'use strict';var v=m.getViewportDimensions().y,w=v-this.$AbstractDialogFitHeight5;k.set(this.$AbstractDialogFitHeight4,this.getHeightProperty(),Math.max(q,w)+'px');this.$AbstractDialogFitHeight1.updatePosition();};f.exports=u;},null);
__d('DialogFitHeight',['AbstractDialogFitHeight'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.getHeightProperty=function(){'use strict';return 'height';};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('StickerStoreController',['Bootloader','DialogFitHeight','DOM','LayerAutoFocus','LayerFadeOnHide','LayerHideOnEscape','React','ReactComponentRenderer','StickerActions','XUIDialog.react','XUIDialogBody.react','XUISpinner.react','cx','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=n.PropTypes,w=688,x=null,y=n.createClass({displayName:'StoreLayer',propTypes:{isComposer:v.bool,shown:v.bool},getDefaultProps:function(){return {isComposer:false,shown:false};},getInitialState:function(){return {renderStore:function(){return (n.createElement('div',{className:"_5r5e"},n.createElement(s,{background:'light',size:'large'})));}};},componentDidMount:function(){h.loadModules(["StickerStore.react"],(function(ba){this.setState({renderStore:(function(){return (n.createElement(ba,{isComposer:this.props.isComposer,shown:this.props.shown}));}).bind(this)});}).bind(this));},_onToggle:function(ba){u((function(){return this.setProps({shown:ba});}).bind(this));},render:function(){return (n.createElement(q,{behaviors:{DialogFitHeight:i,LayerAutoFocus:k,LayerFadeOnHide:l,LayerHideOnEscape:m},onToggle:this._onToggle,shown:this.props.shown,width:w},n.createElement(r,{className:"_5rq- autofocus"},this.state.renderStore())));}});function z(ba){var ca=j.create('div');j.appendContent(document.body,ca);x=new o(y,ca);x.setProps({isComposer:ba,shown:true});}var aa={showStore:function(ba,ca){if(!x){z(!!ca);}else x.setProps({shown:true,isComposer:!!ca});p.selectStorePack(ba);}};f.exports=aa;},null);
__d('StickerStateStore',['FluxStore','StickerActions','StickerInterfaces','StickersDispatcher','StickerState','StickerStoreController','arrayContains','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p,q;'use strict';p=babelHelpers.inherits(r,h);q=p&&p.prototype;function r(){q.constructor.call(this,k);this.$StickerStateStore1=false;}r.prototype.getState=function(s){var t=null;if(s===j.COMPOSER){t=l.getPacksInComposerTray();}else if(s===j.COMMENTS){t=l.getPacksInCommentsTray();}else if(s===j.FRAMES){t=l.getPacksInFramesTray();}else t=l.getPacksInTray();return {showTray:this.$StickerStateStore2,storePackID:l.getStorePackID(),packID:l.getTrayPackID(t),trayPacks:t,numNewPacks:l.getNumNewPacks(),threadID:this.$StickerStateStore3,trayDataReady:this.$StickerStateStore1};};r.prototype.isPackInTray=function(s){if(!this.$StickerStateStore1)l.onTrayDataReady(o);var t=l.getPacksInTrayAllInterfaces();return t.some(function(u){return u.id===s;});};r.prototype.__onDispatch=function(s){var t=i.Types;switch(s.type){case t.REPLACE_STICKER_STATE:this.$StickerStateStore2=!!s.showTray;break;case t.SHOW_TRAY:this.$StickerStateStore2=true;this.$StickerStateStore3=s.threadID;break;case t.HIDE_TRAY:this.$StickerStateStore2=false;break;case t.CLICKED_STICKER_IN_THREAD:l.onTrayDataReady((function(){if(n(l.getPackIDsInTray(),s.packID)){l.setTrayPackID(s.packID);this.$StickerStateStore2=true;this.$StickerStateStore3=s.threadID;}else{this.$StickerStateStore2=false;m.showStore(s.packID);}}).bind(this));break;case t.SELECT_PACK:l.setTrayPackID(s.packID);break;case t.SELECT_STORE_PACK:l.setStorePackID(s.packID);break;case t.RESET_NUM_NEW_PACKS:l.resetNumNewPacks();break;case t.ADD_PACK:l.addPack(s.packID);break;case t.REMOVE_PACK:l.removePack(s.packID);break;case t.UPDATE_TRAY_DATA:break;case t.TRAY_DATA_READY:this.$StickerStateStore1=true;break;}this.__emitChange();};f.exports=new r();},null);
__d('legacy:CompactTypeaheadRenderer',['CompactTypeaheadRenderer'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadRenderers)b.TypeaheadRenderers={};b.TypeaheadRenderers.compact=c('CompactTypeaheadRenderer');},3);